var V=Object.defineProperty,N=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var L=(s,t,e)=>t in s?V(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,m=(s,t)=>{for(var e in t||(t={}))M.call(t,e)&&L(s,e,t[e]);if(P)for(var e of P(t))Y.call(t,e)&&L(s,e,t[e]);return s},O=(s,t)=>N(s,G(t));var T=(s,t,e)=>L(s,typeof t!="symbol"?t+"":t,e);var A=(s,t,e)=>new Promise((o,a)=>{var c=n=>{try{i(e.next(n))}catch(l){a(l)}},r=n=>{try{i(e.throw(n))}catch(l){a(l)}},i=n=>n.done?o(n.value):Promise.resolve(n.value).then(c,r);i((e=e.apply(s,t)).next())});const K=function(){const t=typeof document!="undefined"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),W=function(s){return"https://play.gotolstoy.com/widget-v2/"+s},g={},w=function(t,e,o){let a=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),i=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));a=Promise.allSettled(e.map(n=>{if(n=W(n),n in g)return;g[n]=!0;const l=n.endsWith(".css"),D=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${D}`))return;const _=document.createElement("link");if(_.rel=l?"stylesheet":K,l||(_.as="script"),_.crossOrigin="",_.href=n,i&&_.setAttribute("nonce",i),document.head.appendChild(_),l)return new Promise((b,B)=>{_.addEventListener("load",b),_.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${n}`)))})}))}function c(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return a.then(r=>{for(const i of r||[])i.status==="rejected"&&c(i.reason);return t().catch(c)})},k={PRODUCT_TILE:"tolstoy-product-tile"},et="./styles/product-tile.css",st="w-full",H="tolstoy-collection-page-tile",ot="./styles/collection-page-tile.css",nt={display:"flex",width:"100%",height:"100%",position:"relative"},v={PRODUCT_TILE:{key:k.PRODUCT_TILE,controller:()=>w(()=>import("./4cfd275ac/product-tiles-controller.DfSMRFRp.js"),[])},COLLECTION_PAGE_TILE:{key:H,controller:()=>w(()=>import("./4cfd275ac/collection-page-tile-controller.C6XQL4pi.js"),[])}},q={BASE_URL:"https://play.gotolstoy.com/widget-v2",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"https://api.gotolstoy.com",VITE_API_LB_BASE_URL:"https://apilb.gotolstoy.com",VITE_API_LB_CDN_BASE_URL:"https://cf-apilb.gotolstoy.com",VITE_ENV:"production",VITE_INDEX_PATH:"./widget.js",VITE_REACT_APP_API_BASE_URL:"https://api.gotolstoy.com",VITE_REACT_APP_ASSETS_OUTPUT:"https://assets.gotolstoy.com",VITE_REACT_APP_CONFIG_URL_CDN:"https://d39ynn9qmq2swd.cloudfront.net/public/published",VITE_REACT_APP_FACEBOOK_ANALYTICS_KEY:"4003456519730074",VITE_REACT_APP_GOOGLE_ANALYTICS_KEY:"UA-180961004-6",VITE_REACT_APP_IMAGE_OUTPUT:"https://tolstoy-files-prod-output.s3.amazonaws.com",VITE_REACT_APP_MUX_DATA_KEY:"udo8kqf9tsneg0t116idg2afe",VITE_REACT_APP_PROJECTS_URL:"https://tolstoyprojects221542-prod.s3.amazonaws.com/public",VITE_REACT_APP_VIDEO_OUTPUT:"videos.gotolstoy.com",VITE_REACT_APP_ZEROBOUNCE_KEY:"3f8e942efa104ecba7d77cd94845d95a"},S=s=>{const t=q[s];return t===void 0?"":t},rt=()=>S("VITE_ENV")==="production",j=()=>S("VITE_ENV")==="development",it=()=>S("VITE_API_LB_BASE_URL"),at=()=>S("VITE_API_LB_CDN_BASE_URL"),ct=()=>S("VITE_API_BASE_URL"),z="td=true",F=window.location.search.includes(z)||j(),y=(...s)=>{F&&console.log("Tolstoy Error",...s)};var p=(s=>(s.LOADING="loading",s.SUCCESS="success",s.FAILED="failed",s))(p||{});const lt={COLLECTION_PAGE_TILE:"collection-page-tile",PRODUCT_TILE:"product-tile"},R={PUBLISH_ID:"data-publish-id",PRODUCT_ID:"data-product-id",COLLECTION_ID:"data-collection-id",STATUS:"data-status"},f=Object.values(v).map(({key:s})=>s),C=new Map;let U=!1;const $=s=>{const t=o=>o instanceof HTMLElement?f.some(a=>o.classList.contains(a))?!0:f.some(a=>o.getElementsByClassName(a).length>0):!1,e=new MutationObserver(o=>{o.some(c=>c.type==="childList"&&Array.from(c.addedNodes).some(r=>t(r)))&&s()});return e.observe(document.body,{childList:!0,subtree:!0}),e},Q=(s,t)=>A(void 0,null,function*(){if(C.get(s)===t||s.dataset.status)return;const e=Object.values(v).find(({key:o})=>o===t);if(e)try{s.setAttribute(R.STATUS,p.LOADING),yield(yield e.controller()).default(s),C.set(s,t)}catch(o){y("error in widgetLoader",o),s.setAttribute(R.STATUS,p.FAILED),C.delete(s)}}),I=()=>A(void 0,null,function*(){const s=f.flatMap(t=>{const e=document.getElementsByClassName(t);return Array.from(e).map(o=>Q(o,t))});yield Promise.all(s)}),x=()=>{U||(window.addEventListener("DOMContentLoaded",I),window.addEventListener("load",I),"MutationObserver"in window&&$(I),U=!0)},X=()=>A(void 0,null,function*(){x(),yield I()}),E={SUBSCRIBE:"TOLSTOY_WIDGET_V2_SUBSCRIBE",MESSAGE:"TOLSTOY_WIDGET_V2_MESSAGE"},u={ADD_TO_CART:"tolstoy_add_to_cart",SPOTLIGHT_QUICK_SHOP:"tolstoy_spotlight_carousel_quick_shop_click",PRODUCT_CARD_CLICK:"tolstoy_product_card_click"},d=class d{constructor(){T(this,"subscribers");T(this,"eventsStatus");T(this,"handleMessage",t=>{const{detail:e}=t;if(e!=null&&e.eventName)switch(e.eventName){case u.ADD_TO_CART:case u.SPOTLIGHT_QUICK_SHOP:case u.PRODUCT_CARD_CLICK:this.subscribe(e.eventName,e.callback);break;default:this.notifySubscribers(e.eventName,e)}});this.subscribers=new Map,this.eventsStatus={[u.ADD_TO_CART]:!1,[u.SPOTLIGHT_QUICK_SHOP]:!1,[u.PRODUCT_CARD_CLICK]:!1}}static getInstance(){return d.instance||(d.instance=new d),d.instance}formatMessage(t){return O(m({},t),{transmissionId:t.transmissionId||"widget-v2",timestamp:Date.now()})}updateEventStatus(t,e){t in this.eventsStatus&&(this.eventsStatus[t]=e)}isEventSubscribed(t){return this.eventsStatus[t]||!1}notifySubscribers(t,e){const o=this.subscribers.get(t);o==null||o.forEach(a=>{try{a(e)}catch(c){console.error(`Error in ${t} callback:`,c)}})}subscribe(t,e){var o;this.subscribers.has(t)||this.subscribers.set(t,new Set),(o=this.subscribers.get(t))==null||o.add(e),this.updateEventStatus(t,!0)}unsubscribe(t,e){const o=this.subscribers.get(t);o==null||o.delete(e),(o==null?void 0:o.size)===0&&this.updateEventStatus(t,!1)}postMessage(t){const e=this.formatMessage(t),o=new CustomEvent(E.MESSAGE,{detail:e});window.dispatchEvent(o)}init(){window.addEventListener(E.SUBSCRIBE,this.handleMessage),window.addEventListener(E.MESSAGE,this.handleMessage);const t=new CustomEvent(E.SUBSCRIBE);window.addEventListener("tolstoyWidgetReady",()=>{window.dispatchEvent(t)},{once:!0})}destroy(){window.removeEventListener(E.SUBSCRIBE,this.handleMessage),window.removeEventListener(E.MESSAGE,this.handleMessage)}};T(d,"instance");let h=d;const J=()=>{h.getInstance().init()},Z=()=>A(void 0,null,function*(){try{J(),yield X()}catch(s){y(s)}});Z();export{ot as C,R as D,h as E,et as P,p as W,w as _,it as a,st as b,lt as c,nt as d,z as e,j as f,at as g,ct as h,rt as i,y as l};

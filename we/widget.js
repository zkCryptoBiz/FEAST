var ns=Object.defineProperty,is=Object.defineProperties;var rs=Object.getOwnPropertyDescriptors;var Et=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var $t=(e,t,o)=>t in e?ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,E=(e,t)=>{for(var o in t||(t={}))Pe.call(t,o)&&$t(e,o,t[o]);if(Et)for(var o of Et(t))Re.call(t,o)&&$t(e,o,t[o]);return e},w=(e,t)=>is(e,rs(t));var Me=(e,t)=>{var o={};for(var s in e)Pe.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&Et)for(var s of Et(e))t.indexOf(s)<0&&Re.call(e,s)&&(o[s]=e[s]);return o};var y=(e,t,o)=>($t(e,typeof t!="symbol"?t+"":t,o),o);var h=(e,t,o)=>new Promise((s,n)=>{var i=l=>{try{c(o.next(l))}catch(d){n(d)}},r=l=>{try{c(o.throw(l))}catch(d){n(d)}},c=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,r);c((o=o.apply(e,t)).next())});const R={pageView:"pageView",sessionStart:"sessionStart",sessionEnd:"sessionEnd",videoPause:"videoPause",videoStart:"videoStart",videoResume:"videoResume",videoReplay:"videoReplay",clickCta:"clickCta",submitInput:"submitInput",collectInfo:"collectInfo",videoResponse:"videoResponse",audioResponse:"audioResponse",imageResponse:"imageResponse",tolstoyClick:"tolstoyClick",chapterSelected:"chapterSelected",chapterPickerOpened:"chapterPickerOpened",videoSeeked:"videoSeeked",shareClick:"shareClick",quizResult:"quizResult",autoplayStart:"autoplayStart"},m={sessionStart:"tolstoyStarted",sessionEnd:"tolstoyReachedEnd",clickCta:"tolstoyAnswerClicked",submitInput:"tolstoyInputSubmit",collectInfo:"tolstoyLeadFormSubmit",videoResponse:"tolstoyVideoSubmit",audioResponse:"tolstoyAudioSubmit",imageResponse:"tolstoyImageSubmit",openGorgias:"tolstoyOpenGorgias",hideGorgias:"tolstoyHideGorgias",openIntercom:"tolstoyOpenIntercom",hideIntercom:"tolstoyHideIntercom",openTawkTo:"tolstoyOpenTawkTo",hideTawkTo:"tolstoyHideTawkTo",openLiveChat:"tolstoyOpenLiveChat",hideLiveChat:"tolstoyHideLiveChat",openHubSpot:"tolstoyOpenHubSpot",hideHubSpot:"tolstoyHideHubSpot",openHelpScout:"tolstoyOpenHelpScout",hideHelpScout:"tolstoyHideHelpScout",openDrift:"tolstoyOpenDrift",hideDrift:"tolstoyHideDrift",openZendesk:"tolstoyOpenZendesk",hideZendesk:"tolstoyHideZendesk"},dc="tolstoyEscapeKeyPressed",as="tolstoyWatchedProductIds",uc="showFeedProductModal",pc="tolstoyWidgets",hc="showFeedCartMobile",yc="tolstoyMoveToUrl",gc="tolstoyCloseModalMessage",Ze="tolstoyPlayerReady",Y={OPEN:"open",CLOSE:"close",PLAY:"play",PAUSE:"pause"},cs=[Y.OPEN,Y.PLAY],ls=[Y.CLOSE,Y.PAUSE],Ec={ready:"tolstoyPreConfigMessengerReady",vodAssetIds:"tolstoyVodAssetIds"},mc="rechargeMessaging",wc="tolstoyRechargeWidgetData",fc="tolstoyRequestRechargeWidgetData",Sc="tolstoyRequestRechargeAddToCart",Q={static:"static",dynamic:"dynamic",hoverOver:"hoverOver"},Tc={under:"under",over:"over"},ds={carousel:"tolstoy-carousel",carouselContainer:"tolstoy-carousel-container",title:"tolstoy-carousel-title",videoCarouselContainer:"tolstoy-video-carousel-container",previousButton:"tolstoy-previous-button",nextButton:"tolstoy-next-button",arrowsContainer:"tolstoy-carousel-arrows-container",videosContainer:"tolstoy-carousel-videos-container",videoContainer:"tolstoy-carousel-video-container",video:"tolstoy-carousel-video",image:"tolstoy-carousel-image",dotsContainer:"tolstoy-dots-container",dot:"tolstoy-dot",playButtonContainer:"tolstoy-play-button-container",controlsContainer:"tolstoy-carousel-controls-container",expandButton:"tolstoy-carousel-expand-button",muteButton:"tolstoy-carousel-mute-button",playButton:"tolstoy-carousel-play-button",tileContainer:"tolstoy-carousel-tile-container",tile:"tolstoy-carousel-tile",centerTile:"tolstoy-carousel-center-tile",tileNameContainer:"tolstoy-tile-name-container",tileNameText:"tolstoy-carousel-tile-name-text",arrowButtonContainer:"tolstoy-carousel-arrow-button-container",arrowButton:"tolstoy-carousel-arrow-button",tileNameHeightPlaceholder:"tolstoy-tile-name-height-placeholder",productTile:"tolstoy-product-tile",productContent:"tolstoy-product-content",productTileImage:"tolstoy-product-tile-image",productTileTitle:"tolstoy-product-tile-title",tileText:"tolstoy-tile-text",variantTile:"tolstoy-product-variant-tile",variantTileIcon:"tolstoy-product-variant-tile-icon",variantTileTitle:"tolstoy-product-variant-tile-title",productTilePrice:"tolstoy-product-tile-price",productTileSubtitle:"tolstoy-product-tile-subtitle",productTileButton:"tolstoy-product-tile-button",productTileArrow:"tolstoy-product-tile-arrow",productTileFallback:"tolstoy-product-tile-fallback",descriptionTile:"tolstoy-description-tile",descriptionTileContent:"tolstoy-description-tile-content",descriptionTileButton:"tolstoy-description-tile-button"},Ic=6,bc=2,_c=80,Cc=.3,vc=80,Ac=12,us=416,Oc={DEFAULT:"default",SPOTLIGHT:"spotlight"},Pc={product:"product",videoName:"videoName",none:"none"},Rc={shoppableVideoCarousel:"Shoppable Video Carousel",viewProduct:"View Product"},ps={embed:"tolstoy-embed",iframe:"tolstoy-embed-iframe",videoPreview:"tolstoy-embed-video-preview",videoContainer:"tolstoy-embed-video-container",playButtonContainer:"tolstoy-embed-play-button-container",startText:"tolstoy-embed-start-text",startButtonContainer:"tolstoy-embed-start-button-container",startButton:"tolstoy-embed-start-button",embedContainer:"tolstoy-embed-container"},Mc=9/16,hs={story:"tolstoy-stories",storiesMainContainer:"tolstoy-stories-main-container",storiesContainer:"tolstoy-stories-container",tilesContainer:"tolstoy-stories-tiles-container",tileName:"tolstoy-stories-tile-name",storyTile:"tolstoy-stories-tile",storyImage:"tolstoy-stories-story-image",storyVideo:"tolstoy-stories-story-video",plusTile:"tolstoy-stories-plus-tile",storyName:"tolstoy-stories-story-name",titleContainer:"tolstoy-stories-title",plusTileContainer:"tolstoy-stories-plus-tile-container",previousButton:"tolstoy-stories-previous-button",nextButton:"tolstoy-stories-next-button",onYouButton:"tolstoy-stories-on-you-button",onlyOnYouButton:"tolstoy-stories-only-on-you-button",playButtonContainer:"tolstoy-stories-play-button-container"},ys=".0000000.jpg",gs=".avatar",Lc=`${gs}${ys}`,Nc={static:Q.static,dynamic:Q.dynamic},Es={responsive:"responsive",fixed:"fixed"},Uc={below:"below",overlay:"overlay"},Dc=Es.fixed,kc=8,Bc=80,$c=8,Hc=256,ms={tile:"tolstoy-tile",tileContainer:"tolstoy-tile-container",video:"tolstoy-tile-video",nativeCaptionsTrack:"tolstoy-tile-native-captions-track",customCaptionsTrack:"tolstoy-tile-custom-captions-track",imageOverlay:"tolstoy-tile-image-overlay",image:"tolstoy-tile-image",controlsOverlay:"tolstoy-tile-controls-overlay",controlsContainer:"tolstoy-tile-controls",playButtonOverlay:"tolstoy-tile-play-button-overlay",playButtonContainer:"tolstoy-tile-play-button-container",playButtonLabelContainer:"tolstoy-tile-play-button-label-container",playButtonLabel:"tolstoy-tile-play-button-label",timebarWrapper:"tolstoy-tile-timebar-wrapper",timebarContainer:"tolstoy-tile-timebar-container",timebar:"tolstoy-tile-timebar",timeIndicator:"tolstoy-tile-time-indicator",muteButton:"tolstoy-tile-mute-button",fullScreenButton:"tolstoy-tile-full-screen-button",togglesContainer:"tolstoy-tile-toggles",captionsButton:"tolstoy-tile-captions-button"},ws={collectionTile:"tolstoy-collection-tile",video:"tolstoy-collection-tile-video",controlsContainer:"tolstoy-collection-tile-controls-container",playButton:"tolstoy-collection-tile-play-button",muteButton:"tolstoy-collection-tile-mute-button"},xc={AUTOPLAY:"autoplay",CLICK:"click"},Wc={CONSECUTIVELY:"consecutively",SIMULTANEOUSLY:"simultaneously"},Vc={LOOP:"loop",PLAY_ONCE:"playOnce"},Yc={PDP:"pdp",PLAY:"play"},Fc="data-tolstoy-collection-tile-key",Xe="tolstoy-collection-page-tile",Qt="carousel",fs="inTileCarousel",Qe="bubble",Jt="stories",te="embed",Gc="onYou",ee="tile",Je="centeredModal",Ct="collectionTile",to="collectionPageTile",Kc={clickedX:"stopShowingWidgetToClickedX",viewed:"stopShowingWidgetToViewed"},eo={[Qt]:ds.carousel,[Jt]:hs.story,[te]:ps.embed,[ee]:ms.tile,[Ct]:ws.collectionTile,[to]:Xe},Ss="siteActivity",Ts="pageVisit",jc={notAllowedError:"NotAllowedError",abortError:"AbortError"},Is=1,lt={shop:"shop",appKey:"app-key",productId:"product-id",shouldUseCache:"should-use-cache",cacheVersion:"cache-version"},le={tolstoyAutoOpen:"tolstoyAutoOpen",tolstoyAutoOpenOnYou:"tolstoyAutoOpenOnYou",tolstoyStartVideo:"tolstoyStartVideo"},bs="PRODUCT_ID",qc={TOP:"top",BOTTOM:"bottom"},f={embedView:"embedView",embedPlay:"embedPlay",embedPause:"embedPause",embedMute:"embedMute",embedUnmute:"embedUnmute",embedExpand:"embedExpand",tolstoyModalClose:"tolstoyModalClose",feedProductModalOpen:"feedProductModalOpen",feedProductModalClose:"feedProductModalClose",videoLoaded:"videoLoaded",pageView:"pageView",clickViewProduct:"clickViewProduct",openProductPageClick:"openProductPageClick",feedPlay:"feedPlay",feedPause:"feedPause",videoMuted:"videoMuted",videoUnmuted:"videoUnmuted",videoWatched:"videoWatched",openShareLink:"Open Share Link",feedNavigationArrowClick:"feedNavigationArrowClick",feedScroll:"feedScroll",sessionStart:"sessionStart",tolstoyStarted:"tolstoyStarted",abTestInitialized:"abTestInitialized",onYouClick:"onYouClick"},oo="https://api.gotolstoy.com",de="https://apilb.gotolstoy.com",so="https://cf-apilb.gotolstoy.com",_s="https://player.gotolstoy.com",Cs="https://on-you.gotolstoy.com",zc="https://play.gotolstoy.com/hero",oe="widget.gotolstoy.com",no="https://videos.gotolstoy.com",vs="https://api.gotolstoy.com/migrations/recreate-video",As="https://analytics-v2.gotolstoy.com/site-activity",Os="https://analytics-v2.gotolstoy.com/page-visit",Ps="custom-blocks.tapcart.com",dt=()=>{var e,t,o;return!!((e=window==null?void 0:window.Tapcart)!=null&&e.isInitialized||(o=(t=document.location)==null?void 0:t.host)!=null&&o.includes(Ps))},io=()=>{var t,o,s;const e=(s=(o=(t=window==null?void 0:window.Tapcart)==null?void 0:t.variables)==null?void 0:o.device)==null?void 0:s.id;return e==null?void 0:e.toLowerCase()},ue={TOLSTOY_HIDE_WIDGET_STORAGE_KEY:"tolstoy-hide-widget",TOLSTOY_SESSION_ID_KEY:"tolstoy-session-id",TOLSTOY_SESSION_UNIQUE_ID_KEY:"tolstoy-session-unique-id",TOLSTOY_PRODUCT_RECOMMENDATIONS:"tolstoy-product-recommendation",TOLSTOY_ANONYMOUS_ID:"tolstoy-anonymousId",TOLSTOY_REPLY:"tolstoy-reply",TOLSTOY_GROUP:"tolstoy-group",TOLSTOY_PUBLISH_ID:"tolstoy-publishId",TOLSTOY_ACTIVITY_KEY:"tolstoy-activity",TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:"tolstoy-not-visible-opened-publish-id",TOLSTOY_INTERACTION_DATE:"tolstoy-interaction-date",IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:"tolstoy-is-shopify-cart-anonymous-id-set",TOLSTOY_COOKIE_POLICY:"tolstoy-cookie-policy",TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:"tolstoy-recreate-resolutions",TOLSTOY_AB_TEST_GROUP:"tolstoy-ab-test-group"},Rt={accepted:"accepted",rejected:"rejected"},T={IDENTIFY_INFO_ID_KEY:"identifyInfoId",SESSION_COUNTER_KEY:"tolstoySessionCounter",LAST_SEEN_AT_KEY:"tolstoyLastSeenAtKey",FIRST_SEEN_AT_KEY:"tolstoyFirstSeenAtKey",TOLSTOY_VIEWERS_KEY:"tolstoyViewers",TOLSTOY_VIEWED_PRODUCTS:"tolstoyViewedProducts",CURRENT_CUSTOMER_EMAIL_KEY:"tolstoyCurrentCustomer",BUBBLE_TEXT_PREFIX:"bubbleText",NOTIFICATION_BADGE_PREFIX:"notificationBadge",RECREATE_NEW_RESOLUTION_PREFIX:"reCreateNewResolution"},{TOLSTOY_COOKIE_POLICY:ro}=ue;function vt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.trunc(Math.random()*16);return(e==="x"?t:t&3|8).toString(16)})}function F(e){var t;try{return e()}catch(o){return(t=window.tolstoyCaptureError)==null||t.call(window,o),null}}function L(e){return F(()=>window.sessionStorage.getItem(e))}function O(e){return F(()=>localStorage.getItem(e))||L(e)}function ct(e){return O(e)||L(e)}function N(e,t,o=!1){F(()=>{if(!(pe()===Rt.rejected&&!o))return window.sessionStorage.setItem(e,t)})}function U(e,t,o=!1){F(()=>{if(pe()!==Rt.rejected)return localStorage.setItem(e,t);if(o)return window.sessionStorage.setItem(e,t)})}function H(e,t,o=!1){F(()=>{if(pe()!==Rt.rejected)return localStorage.setItem(e,t);if(o)return window.sessionStorage.setItem(e,t)})}function Rs(e){return F(()=>window.sessionStorage.removeItem(e))}const pe=()=>ct(ro),Ms=e=>{H(ro,e,!0)},ao=e=>{const t=window.location.host;document.cookie=`${e}=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 UTC;`,document.cookie=`${e}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`},bt=e=>[...Object.values(ue),...Object.values(T)].some(o=>e.includes(o));function Ls(){const e=document.cookie.split("; ");for(const t of e){const[o]=t.split("=");bt(o.trim())&&ao(o)}for(const t in localStorage)bt(t)&&localStorage.removeItem(t);for(const t in sessionStorage)bt(t)&&sessionStorage.removeItem(t)}const Ns=()=>{const e=document.cookie.split("; ");for(const t of e){const[o]=t.split("=");bt(o.trim())&&ao(o)}};Ns();const{TOLSTOY_HIDE_WIDGET_STORAGE_KEY:he,TOLSTOY_SESSION_ID_KEY:ye,TOLSTOY_SESSION_UNIQUE_ID_KEY:co,TOLSTOY_PRODUCT_RECOMMENDATIONS:Us,TOLSTOY_ANONYMOUS_ID:lo,TOLSTOY_REPLY:Ds,TOLSTOY_GROUP:Zc,TOLSTOY_PUBLISH_ID:ks,TOLSTOY_ACTIVITY_KEY:Mt,TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:uo,TOLSTOY_INTERACTION_DATE:Le,IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:po,TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:Xc,TOLSTOY_AB_TEST_GROUP:ho}=ue;function se(e){return e?`${Le}-${e}`:Le}function Bs(){return ct(lo)}function $s(e){!e||["undefined","false"].includes(e)||H(lo,e)}function Lt(){let t=(dt()?io():null)||Bs()||vt();return t==="false"&&(t=vt()),$s(t),t}function Hs(e){H(ks,e,!0)}function At(){return JSON.parse(L(Mt)||"{}")}function yo({publishId:e,timeStamp:t,type:o,sessionId:s}){const n=At()||{},i=n[e]||[];n[e]=[...i,{timeStamp:t,type:o,sessionId:s}],N(Mt,JSON.stringify(n),!0)}const xs=({publishId:e,productId:t})=>{const o=Vs(),s=o[t]||[],n={interactionDate:new Date().toISOString(),publishId:e,productId:t};s.push(n),o[t]=s,Ys(o)},Ws=()=>{N(Mt,"{}",!0)};function Qc(e){H(Ds,e)}function Jc(){H(Us,!0)}const Ht=()=>JSON.parse(O(T.TOLSTOY_VIEWERS_KEY)||"{}"),Vs=()=>JSON.parse(ct(T.TOLSTOY_VIEWED_PRODUCTS)||"{}"),Ys=e=>{H(T.TOLSTOY_VIEWED_PRODUCTS,JSON.stringify(e))},xt=e=>{U(T.TOLSTOY_VIEWERS_KEY,JSON.stringify(e))};function Fs(e){return ct(se(e))||ct(se())}function Gs(e){U(T.IDENTIFY_INFO_ID_KEY,e)}function Ks(){return O(T.IDENTIFY_INFO_ID_KEY)}function js(){localStorage.removeItem(T.IDENTIFY_INFO_ID_KEY)}const qs=e=>{U(T.SESSION_COUNTER_KEY,e)},go=()=>Number(O(T.SESSION_COUNTER_KEY)),zs=e=>{U(T.FIRST_SEEN_AT_KEY,e)},Eo=()=>O(T.FIRST_SEEN_AT_KEY);function Zs(e){const t=new Date().toISOString();H(se(e),t)}const mo=e=>L(`${he}-${e}`),tl=e=>N(`${he}-${e}`,"true",!0),el=e=>window.sessionStorage.removeItem(`${he}-${e}`),Nt=()=>L(ye),wo=e=>N(ye,e,!0),ol=()=>Rs(ye),ge=()=>{const e=L(co);return e||Xs()},Xs=()=>{const e=vt();return N(co,e,!0),e},Qs=()=>{const e=L(uo);return!e||e==="null"?null:e},Ee=e=>N(uo,e,!0),Js=(e,t)=>{const o=At()||{},s=o[e]||[];if(!(s!=null&&s.length))return;const n=s[s.length-1];n.sessionId=t,N(Mt,JSON.stringify(o),!0)},tn=()=>L(po),en=e=>N(po,e),sl=(e,t)=>U(`${T.NOTIFICATION_BADGE_PREFIX}-${e}`,t,!0),nl=e=>O(`${T.NOTIFICATION_BADGE_PREFIX}-${e}`),il=(e,t,o)=>U(`${T.BUBBLE_TEXT_PREFIX}-${e}-${t}`,o,!0),rl=(e,t)=>O(`${T.BUBBLE_TEXT_PREFIX}-${e}-${t}`),al=(e,t)=>U(`${T.RECREATE_NEW_RESOLUTION_PREFIX}-${e}`,t,!0),cl=e=>O(`${T.RECREATE_NEW_RESOLUTION_PREFIX}-${e}`),on=(e,t)=>U(`${ho}-${e}`,t,!0),sn=e=>O(`${ho}-${e}`),nn="player-version",rn=(e,t)=>{const o=e.src;return new URL(o).searchParams.get(t)},an=(e,t)=>e.getAttribute(`data-${t}`),ut=e=>{const t=document.querySelectorAll(`script[src*="${oe}"]`);for(const o of t){const s=an(o,e)||rn(o,e);if(s)return s}},cn=e=>{var o;const t=(o=e==null?void 0:e.dataset)==null?void 0:o.productId;return t==="{{ product.id }}"?null:t},Ut=()=>{const e=ut(lt.productId);if(e)return e;const{stories:t,carousel:o,embed:s,tile:n}=eo,i=document.querySelectorAll(`.${t}, .${o}, .${s}, .${n}`);for(const r of i){const c=cn(r);if(c)return c}},fo=()=>ut(lt.shouldUseCache)==="true",x=()=>ut(lt.cacheVersion);function Dt(){return ut(lt.shop)}const So="widget-loading",ll="widget-onyou",dl="widget-onyou-enableAllPages",ln="widget-video-fallback",ul="carousel-show-dots",pl="carousel-videos",hl="hide-spotlight-plus-button",yl="app-use-creator-profile",dn="block-shopify-add-to-cart-attribute",gl="shopify-price-formatting",me=({config:e,featureKey:t})=>{var o;return(o=e==null?void 0:e.featureSettings)==null?void 0:o[t]},un=({config:e,featureKey:t})=>{var o;return!!((o=e==null?void 0:e.featureSettings)!=null&&o[t])},El=(e={})=>{const t=me({config:e,featureKey:So});return t==null?void 0:t.playerLazy},To=(e={})=>{const t=me({config:e,featureKey:So});return t==null?void 0:t.playerOrigin},ml=(e={})=>{const t=me({config:e,featureKey:ln});return t==null?void 0:t.dontUseFallback},pn="www.",Io=new RegExp("^((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)","i"),Ne=e=>e?!!Io.test(e)||e.startsWith("tel:")||e.startsWith("mailto:")||e.startsWith("_self:"):!1,Ue=e=>{const t=e.replace(pn,""),o=new URL(t);return`${o.origin}${o.pathname}${o.search}`},wl=(e,t)=>!Ne(e)||!Ne(t)?!1:Ue(e)===Ue(t),hn=()=>{const e=new URLSearchParams(window.location.search),t=new URLSearchParams;for(const[o,s]of e){const n=o.toLowerCase();o.length<50&&s.length<100&&(n.startsWith("custom_")||n.startsWith("utm_"))&&t.append(o,s)}return t},pt=(e={})=>{const t=new URLSearchParams;for(const[o,s]of Object.entries(e))s!=null&&s!==""&&t.append(o,s);return t.toString()},fl=e=>Io.test(e),Sl=e=>new URLSearchParams(window.location.search).get("tolstoy")===e,yn=(e,t,o)=>{if(o)return`${Cs}`;const s=To(e);if(s){const i=D("td"),r=bo(e);return i&&r?s.replace("2.0.0","2.0.0-ls"):r?s.replace("2.0.0","2.0.0-l"):i?s.replace("2.0.0","2.0.0-s"):s}let n=`${_s}`;return t&&(n+="/feed"),e.publishId&&(n+=`/${e.publishId}`),n},De=()=>{var e;return!!(window.Shopify&&((e=window.Shopify)!=null&&e.routes))},D=e=>{var o;if(!("URLSearchParams"in window))return null;try{return new URLSearchParams((o=window.location)==null?void 0:o.search).get(e)}catch(s){if(s)return null}},bo=e=>e.playerLazy||D("pl"),gn=e=>{var t,o;return(o=(t=e==null?void 0:e.featureSettings)==null?void 0:t[nn])==null?void 0:o.version},En=e=>{var t;return(t=e==null?void 0:e.carouselEmbed)!=null&&t.carouselPlayInTileFirst?fs:""},mn=()=>{var e,t,o,s;return((e=window._st)==null?void 0:e.cid)||((s=(o=(t=window.ShopifyAnalytics)==null?void 0:t.meta)==null?void 0:o.page)==null?void 0:s.customerId)||""},wn=()=>new URLSearchParams(window.location.search).get("authToken"),fn=()=>{var e;return((e=window.tolstoyUserInfo)==null?void 0:e.email)||window.tolstoyUser},Sn=()=>D(le.tolstoyAutoOpen)||window.tolstoyAutoOpen,Tl=()=>D(le.tolstoyAutoOpenOnYou)||window.tolstoyAutoOpenOnYou,Il=()=>D(le.tolstoyStartVideo)||window.tolstoyStartVideo,Tn=({data:e,isFeed:t,isOnYou:o,email:s,isDynamic:n,modalId:i,tolstoyStartVideo:r})=>{var kt,K,j,Bt,Te,Ie,be,_e,Ce,ve;const l=[`url=${`${window.location.origin}${window.location.pathname}`.slice(0,1999)}`,`modalId=${i}`],d=wn();d&&l.push(`authToken=${d}`);const g=s||fn();if(g&&l.push(`email=${encodeURIComponent(g)}`),e.productId&&l.push(`productId=${e.productId}`),o){const q=localStorage.getItem("tolstoy-anonymousId"),Ae=((kt=window.Shopify)==null?void 0:kt.shop)||Dt();Ae&&l.push(`appUrl=${Ae}`),e.publishId&&l.push(`publishId=${e.publishId}`),q&&l.push(`tolstoyAnonymousId=${q}`);const Oe=Nt();return Oe&&l.push(`sessionId=${Oe}`),l}e.currentProductDbId&&l.push(`currentPageDbProductId=${e.currentProductDbId}`);const p=((K=window.Shopify)==null?void 0:K.shop)||"",I=!!(De()&&p);if(l.push("host",`safari=${!!(window!=null&&window.safari)}`,`dontDownload=${!!e.dontDownload}`,`playerType=${e.playerType}`,`isShopifyStore=${I}`,`shopifyStoreUrl=${p}`,`ai=${Lt()}`),De()){const q=(Bt=(j=window.Shopify)==null?void 0:j.routes)==null?void 0:Bt.root;q&&l.push(`shopifyRootRoute=${q}`)}(Te=window.tolstoyUserInfo)!=null&&Te.name&&l.push(`name=${encodeURIComponent(window.tolstoyUserInfo.name)}`),(Ie=window.tolstoyUserInfo)!=null&&Ie.phone&&l.push(`phone=${encodeURIComponent(window.tolstoyUserInfo.phone)}`),r&&l.push(`tolstoyStartVideo=${r}`),e.testGroup&&l.push(`group=${e.testGroup}`),e.sneakpeek&&l.push("sneakpeek"),e.sneakpeek_hidden&&l.push("sneakpeek_hidden"),e.token&&l.push(`token=${e.token}`),e.gclid&&l.push(`gclid=${e.gclid}`),e.widgetDelay&&l.push("delay"),e.isShoppable===!1&&l.push(`isShoppable=${e.isShoppable}`),e.si&&l.push(`si=${e.si}`);const b=D("td");b&&l.push(`td=${b}`);const A=bo(e);A&&l.push(`pl=${A}`);const W=gn(e);W&&l.push(`pv=${W}`);const k=En(e);k&&l.push(`playerVariant=${k}`),n&&l.push("isDynamic=true");const G=mn();G&&l.push(`customerId=${G}`);const yt=hn();yt.size>0&&l.push(yt.toString()),dt()&&l.push("isTapcart=true");const gt=To(e);return gt&&e.publishId&&l.push(`publishId=${e.publishId}`),gt&&t&&l.push("isFeed=true"),(be=window.tolstoySettings)!=null&&be.shouldUseCache&&l.push(`shouldUseCache=${(_e=window.tolstoySettings)==null?void 0:_e.shouldUseCache}`),(Ce=window.tolstoySettings)!=null&&Ce.cacheVersion&&l.push(`cacheVersion=${(ve=window.tolstoySettings)==null?void 0:ve.cacheVersion}`),l},bl=({data:e,isFeed:t,isOnYou:o,email:s,isDynamic:n,modalId:i,tolstoyStartVideo:r})=>{const c=yn(e,t,o),l=Tn({data:e,isFeed:t,isOnYou:o,email:s,isDynamic:n,modalId:i,tolstoyStartVideo:r});return`${c}?${l.join("&")}`},In=e=>{var t;return e!=null&&e.length?`${(t=e[0])==null?void 0:t.toUpperCase()}${e==null?void 0:e.slice(1)}`:""},_l=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,_o=()=>{const e=t=>{const o=Math.floor(Math.random()*16);return(t==="x"?o:o&3|8).toString(16)};return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e)},Co=()=>D("td")==="true",bn=e=>{Co()&&console.log(e)},vo=e=>{Co()&&console.error(e)},_n=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,Cl=()=>_n()||window.screen.width<=450||window.screen.height<=450,vl=(e,t=300)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>{e(...s)},t)}},Al=(e=0)=>h(void 0,null,function*(){return new Promise(t=>{setTimeout(t,e)})}),Ol=(e,t=1)=>{const o=Number(e);return Number.isNaN(o)?0:Number.isInteger(o)?o:Number.parseFloat(o.toFixed(t))},Pl=e=>e.replace(/<[^>]*>?/gm,""),Cn=e=>e==null,Rl=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},vn=e=>{const t=/^[\da-f]{8}-[\da-f]{4}-[0-5][\da-f]{3}-[089ab][\da-f]{3}-[\da-f]{12}$/i;return e==null?void 0:e.match(t)},Ao=e=>cs.includes(e),An=e=>ls.includes(e);let mt="";function v(){return window.tolstoyAppKey||mt?window.tolstoyAppKey||mt:(mt=ut(lt.appKey),mt)}const On=4e3;let Oo=!1;const ne=[],Pn=()=>{for(;ne.length>0;){const{eventFunction:e,args:t}=ne.shift();e(...t)}};setTimeout(()=>{Oo=!0,Pn()},On);const we=e=>(...t)=>{if(Oo)return e(...t);ne.push({eventFunction:e,args:t})},ht=()=>{var e,t;return(e=window.tolstoySettings)!=null&&e.shouldUseCache||(t=window.tolstoySettings)!=null&&t.cacheVersion?so:de},Rn=()=>h(void 0,null,function*(){var i,r;const e=v(),t=((i=window.Shopify)==null?void 0:i.shop)||Dt(),o=fo(),s=x(),n=o||s?so:de;try{const c=new URL(`${n}/actions/accounts/${e}`);return s&&c.searchParams.set("v",s),t&&c.searchParams.set("appUrl",t),(yield fetch(c.toString())).json()}catch(c){(r=window.tolstoyCaptureError)==null||r.call(window,c,"Error loading account settings:")}}),Mn=e=>h(void 0,null,function*(){var t;try{return(yield fetch(`${oo}/identify/identify`,{method:"POST",body:JSON.stringify({data:e})})).json()}catch(o){(t=window.tolstoyCaptureError)==null||t.call(window,o,"Error updating identification:")}}),Ml=(e,t)=>h(void 0,null,function*(){var r;const o=Ut(),s=ht(),n=x(),i=pt({widgetType:t,productId:o,publishId:e,v:n});try{return(yield fetch(`${s}/settings/widget/by-publish-id?${i}`)).json()}catch(c){(r=window.tolstoyCaptureError)==null||r.call(window,c,"Error loading config:")}}),Ln=e=>h(void 0,null,function*(){var n;const t=ht(),o=x(),s=pt(w(E({},e),{url:`${window.location.origin}${window.location.pathname}`,v:o}));try{return(yield fetch(`${t}/settings/widget/by-product-url?${s}`)).json()}catch(i){(n=window.tolstoyCaptureError)==null||n.call(window,i,"Error getting product page config:")}}),Nn=e=>h(void 0,null,function*(){var n;const t=ht(),o=x(),s=pt(w(E({},e),{v:o}));try{return(yield fetch(`${t}/settings/widget/by-product-id?${s}`)).json()}catch(i){(n=window.tolstoyCaptureError)==null||n.call(window,i,"Error getting product page config:")}}),Ll=(e,t,o)=>h(void 0,null,function*(){var r;const s=ht(),n=x(),i=pt({publishId:e,externalProductIds:t,collectionId:o,v:n});try{return(yield fetch(`${s}/settings/widget/get-collection-tile-config?${i}`)).json()}catch(c){(r=window.tolstoyCaptureError)==null||r.call(window,c,"Error getting collection tile config:")}}),Un=e=>h(void 0,null,function*(){var o;const t=new URLSearchParams(e);try{return(yield fetch(`${de}/settings/bubble?${t.toString()}`)).json()}catch(s){(o=window.tolstoyCaptureError)==null||o.call(window,s,"Error getting bubble settings:")}}),Nl=(e,t)=>h(void 0,null,function*(){var i;const o=ht(),s=x(),n=pt({publishId:e,collectionId:t,v:s});try{return(yield fetch(`${o}/settings/collection-page-tile-config?${n}`)).json()}catch(r){(i=window.tolstoyCaptureError)==null||i.call(window,r,"Error getting collection page tile config:")}}),Po=e=>h(void 0,null,function*(){var t;if(window.location.origin!=={}.VITE_BASE_URL)try{return yield fetch(`${oo}/events/event`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})}catch(o){(t=window.tolstoyCaptureError)==null||t.call(window,o,"Error sending page view:")}}),ie=we(Po),Ul=e=>h(void 0,null,function*(){var t;try{return yield fetch(`${vs}?publishId=${e}`)}catch(o){(t=window.tolstoyCaptureError)==null||t.call(window,o)}}),Dn=we(e=>{var t;try{window.navigator.sendBeacon(As,JSON.stringify(e))}catch(o){const s="Error occurred in createSiteActivityEvent";console.error(s,o),(t=window.tolstoyCaptureError)==null||t.call(window,o,s)}}),kn=we(e=>{var t;try{window.navigator.sendBeacon(Os,JSON.stringify(e))}catch(o){const s="Error occurred in createPageVisitEvent";console.error(s,o),(t=window.tolstoyCaptureError)==null||t.call(window,o,s)}}),Bn=1e3*60*60*24,z=e=>`tolstoy${In(e)}`,Wt=e=>{Hn(e),$n(e)},$n=e=>{const{data:{name:t,text:o,facebookAnalyticsID:s,playlist:n,collectInfoType:i}}=e;if(!window.fbq||!s||!n)return;const r=`tolstoy-${n}`;switch(t){case m.sessionStart:P(s,`${r}-click`,{value:"Start Tolstoy"});break;case m.clickCta:P(s,`${r}-click`,{value:o});break;case m.submitInput:P(s,`${r}-input`,{value:o});break;case m.collectInfo:P(s,`${r}-${R.collectInfo}`,{value:i});break;case m.videoResponse:P(s,`${r}-${R.videoResponse}`);break;case m.imageResponse:P(s,`${r}-${R.imageResponse}`);break;case m.audioResponse:P(s,`${r}-${R.audioResponse}`);break;case R.sessionEnd:P(s,`${r}-${R.sessionEnd}`);break}},P=(e,t,o)=>{window.fbq("trackSingleCustom",e,t,o)},Hn=e=>{const{data:{name:t,text:o,googleAnalyticsID:s,playlist:n,collectInfoType:i,productNames:r,totalTime:c,videoName:l,type:d,direction:g}}=e;if(!window.gtag&&!window.dataLayer&&!window.ga||!s||!n)return;const p=`tolstoy-${n}`;switch(t){case f.pageView:break;case R.sessionStart:case m.sessionStart:_(s,p,m.sessionStart),_(s,p,"click","Start Tolstoy");break;case m.clickCta:_(s,p,t,o);break;case m.collectInfo:_(s,p,t,i);break;case m.submitInput:case m.imageResponse:case m.audioResponse:case m.videoResponse:case m.sessionEnd:_(s,p,t);break;case f.tolstoyModalClose:_(s,p,f.tolstoyModalClose,c);break;case f.videoLoaded:r&&_(s,p,"tolstoyVideoLoaded-products",r),_(s,p,"tolstoyVideoLoaded-videoName",l);break;case f.feedProductModalOpen:case f.feedProductModalClose:case f.clickViewProduct:case f.openProductPageClick:_(s,p,z(t),r);break;case f.feedPlay:case f.feedPause:case f.videoMuted:case f.videoUnmuted:case f.videoWatched:_(s,p,z(t),l);break;case f.openShareLink:_(s,p,z("openShareLink"),d);break;case f.feedNavigationArrowClick:case f.feedScroll:_(s,p,z(t),g);break;default:_(s,p,z(t),o)}},_=(e,t,o,s)=>{Wn()&&(window.gtag?window.gtag("event",o,{event_category:t,event_label:s,send_to:e}):window.dataLayer&&window.dataLayer.push({event:o,event_category:t,event_label:s,send_to:e}))},re={},Vt=(e,t)=>{re[e]=re[e]||t};let ke=!1;const xn=()=>{var e;if(!ke)try{const t=v();Vn({appKey:t}),ke=!0}catch(t){console.error(t),(e=window.tolstoyCaptureError)==null||e.call(window,t)}},Wn=()=>{var e,t,o,s;return(t=(e=window.Shopify)==null?void 0:e.customerPrivacy)!=null&&t.shouldShowBanner()?((s=(o=window.Shopify)==null?void 0:o.customerPrivacy)==null?void 0:s.currentVisitorConsent().analytics)==="yes":!0},Vn=({appKey:e}={})=>{let t=0,o=!1;if(Ee(null),!vn(e))return;const s=({now:n,performanceNow:i})=>{var b;o=!1;let r=At();jn(n,r),r=At();const c=Math.round(i-t),l=ge(),d=Yn(r),g=window.location.href.split("?")[0],p=Ut(),I={appKey:e,sessionUniqueId:l,timestamp:new Date().toISOString(),anonymousId:Lt(),storeUrl:(b=window.Shopify)==null?void 0:b.shop,siteActivity:d,eventName:Ss,timeOnPage:c,pageUrl:g,currentPageProductId:p};Dn(I),o=!0,Ws()};document.addEventListener("visibilitychange",()=>{var n;try{const i=Date.now(),r=window.performance.now();document.visibilityState==="visible"&&(t=r,o=!1,Kn(i)),document.visibilityState==="hidden"&&!o&&s({now:i,performanceNow:r})}catch(i){console.error(i),(n=window.tolstoyCaptureError)==null||n.call(window,i)}}),window.addEventListener("beforeunload",()=>{var n;if(!o)try{const i=Date.now(),r=window.performance.now();s({now:i,performanceNow:r})}catch(i){console.error(i),(n=window.tolstoyCaptureError)==null||n.call(window,i)}})},Yn=e=>{const t={};for(const[o,s]of Object.entries(re)){const n=e[o];!(n!=null&&n.length)&&!t[o]&&(t[o]={activity:{},totalTime:0,impression:s});const i=Fn({publishId:o,activities:n});let r=0;for(const c of Object.values(i))r+=c;t[o]={activity:i,totalTime:r,impression:s}}return t},Fn=({publishId:e,activities:t})=>{if(!e||!(t!=null&&t.length))return{};const o=Date.now(),s={},n={};for(const{timeStamp:i,type:r,sessionId:c}of t)n[c]=n[c]||0,s[c]===void 0&&(s[c]=!1),Ao(r)&&!s[c]&&(s[c]=!0,n[c]-=i),An(r)&&s[c]&&(s[c]=!1,n[c]+=i);for(const[i,r]of Object.entries(s))r&&(n[i]+=o),(n[i]<=0||n[i]>Bn)&&delete n[i];return n},Gn=e=>{var t;return(t=Object.entries(e).find(([o,s])=>{if(s.length===0)return;const n=s[s.length-1].type;return Ao(n)}))==null?void 0:t[0]},Kn=e=>{const t=Qs(),o=Nt();!t||!o||(yo({publishId:t,timeStamp:e,type:Y.OPEN,sessionId:o}),Ee(null))},jn=(e,t)=>{const o=Gn(t),s=Nt();!o||!s||(yo({publishId:o,timeStamp:e,type:Y.CLOSE,sessionId:s}),Ee(o))},Ro=()=>{var n;const e=v();if(!e)return;const t=window.location.href.split("?")[0],o=Ut(),s={appKey:e,sessionUniqueId:ge(),createdAt:new Date().toISOString(),anonymousId:Lt(),appUrl:(n=window.Shopify)==null?void 0:n.shop,eventName:Ts,parentUrl:t,currentPageProductId:o};kn(s)},Ot={PDP_CAROUSEL:"pdp-carousel",VIDEO_PAGE:"video-page"},M={HEADER:"header",HEADER_AND_BOTTOM_NAVBAR:"header-and-bottom-navbar",CUSTOM_SCREEN:"custom-screen",CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:"custom-screen-and-bottom-navbar"},fe=e=>document.documentElement.style.setProperty("height",`${e}px`,"important"),qn=()=>navigator.userAgent.toLowerCase().includes("android"),zn=e=>{const t=window.screen.availHeight,o=window.Tapcart.variables.device.windowHeight;switch(e){case M.HEADER:return o;case M.HEADER_AND_BOTTOM_NAVBAR:return o;case M.CUSTOM_SCREEN:return t-100;case M.CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:return t-184;default:return o||t}},Zn=e=>{const t=window.screen.availHeight,o=window.Tapcart.variables.device.windowHeight;switch(e){case M.HEADER:return o;case M.HEADER_AND_BOTTOM_NAVBAR:return o-75;case M.CUSTOM_SCREEN:return t-90;case M.CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:return t-175;default:return o||t}},Xn=e=>qn()?zn(e):Zn(e),Qn=(e,t)=>{const o=Xn(t.navType);fe(o)},Jn=e=>`
    <style>
      .tolstoy-video-page iframe {
        display: block !important;
      }
    </style>
    <tolstoy-video-page
      id="tolstoy-tv-container"
      class="tolstoy-video-page"
      data-publish-id="${e}"
    ></tolstoy-video-page>
  `,ti=(e={})=>{const{height:t=490}=e;let o=0;const s=setInterval(function(){o++;const n=document.querySelector(".tolstoy-carousel-container"),i=document.querySelector(".tolstoy-carousel");n&&i?(i.style.display="block",fe(t),clearInterval(s)):o>=50&&clearInterval(s)},200)},ei=(e,t)=>{fe(0),ti(t)},oi=e=>{var o,s,n;const t=(n=(s=(o=window==null?void 0:window.Tapcart)==null?void 0:o.variables)==null?void 0:s.product)==null?void 0:n.id;return`
    <style>
      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
        font-family: Helvetica;
      }
      
      .tolstoy-carousel iframe {
        display: block !important;
      }
    </style>
    <tolstoy-carousel
      class="tolstoy-carousel"
      data-publish-id="${e}"
      style="display: none"
      ${t?`data-product-id="${t}"`:""}
    ></tolstoy-carousel>
  `},si=(e,t)=>h(void 0,null,function*(){switch(t.blockType){case Ot.PDP_CAROUSEL:ei(e,t);break;case Ot.VIDEO_PAGE:Qn(e,t);break}}),ni=()=>h(void 0,null,function*(){const e=document.querySelectorAll("tolstoy-block");if(e.length!==0)for(const t of Array.from(e)){const{publishId:o,blockType:s,navType:n,height:i}=t.dataset||{},r={blockType:s,navType:n,height:i};let c="";switch(s){case Ot.PDP_CAROUSEL:c=oi(o);break;case Ot.VIDEO_PAGE:c=Jn(o);break}c&&(t.outerHTML=c,si(t,r))}}),ii=()=>{const e=new CustomEvent("tolstoyWidgetReady");window.dispatchEvent(e)},Dl=()=>{const e=new CustomEvent(Ze);window.dispatchEvent(e)},ri=function(){const t=typeof document!="undefined"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),ai=function(e){return"https://widget.gotolstoy.com/we/"+e},Be={},C=function(t,o,s){if(!o||o.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(o.map(i=>{if(i=ai(i),i in Be)return;Be[i]=!0;const r=i.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let g=n.length-1;g>=0;g--){const p=n[g];if(p.href===i&&(!r||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const d=document.createElement("link");if(d.rel=r?"stylesheet":ri,r||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),r)return new Promise((g,p)=>{d.addEventListener("load",g),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i})},Mo=({tagName:e,src:t,container:o,attributes:s,style:n,styleString:i,classNames:r,eventListeners:c})=>{const l=document.createElement(e);if(c)for(const[d,g]of Object.entries(c))l.addEventListener(d,g);if(t&&(l.src=t),s)for(const[d,g]of Object.entries(s))l.setAttribute(d,g);if(i&&(l.style.cssText=i),n)for(const[d,g]of Object.entries(n))l.style[d]=g;return r&&l.classList.add(...r),o&&o.append(l),l},$e=({src:e,container:t,attributes:o})=>Mo({tagName:"script",src:e,container:t,attributes:o}),kl=({src:e,container:t,attributes:o,style:s})=>Mo({tagName:"iframe",src:e,container:t,attributes:o,style:s}),ci=({callback:e,classNames:t})=>{const o=d=>t.some(g=>d.getElementsByClassName(g).length>0),s=d=>t.includes(d),n=d=>[...d.classList].some(s),i=d=>d.classList?n(d)||o(d):!1,r=d=>d.type!=="childList"||d.addedNodes.length===0?!1:[...d.addedNodes].some(i),c=d=>{d.some(r)&&e()};new window.MutationObserver(c).observe(document.body,{subtree:!0,childList:!0})},li=({callback:e})=>{window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)},Lo=({callback:e,classNames:t})=>{li({callback:e}),"MutationObserver"in window&&ci({callback:e,classNames:t})},Bl=({video:e,onError:t})=>e==null?void 0:e.play().catch(t),di=e=>{const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},ui=(e,t)=>`${e}-${t}`,pi=(e,t)=>`[data-tolstoy-element="${ui(e,t)}"]`,$l=(e,t)=>window.document.querySelector(pi(e,t)),Hl=(e,t)=>`[${e}="${t}"]`,xl=(e,t)=>window.document.querySelector(`[${e}="${t}"]`),Wl=`<svg style="margin-left: 0.5px; width: 11px !important; height: 10px !important;" width="11" height="10" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.0547 12.5938C12.8203 12.8281 12.3906 12.8281 12.1562 12.5938L7 7.39844L1.80469 12.5938C1.57031 12.8281 1.14062 12.8281 0.90625 12.5938C0.671875 12.3594 0.671875 11.9297 0.90625 11.6953L6.10156 6.5L0.90625 1.34375C0.671875 1.10938 0.671875 0.679688 0.90625 0.445312C1.14062 0.210938 1.57031 0.210938 1.80469 0.445312L7 5.64062L12.1562 0.445312C12.3906 0.210938 12.8203 0.210938 13.0547 0.445312C13.2891 0.679688 13.2891 1.10938 13.0547 1.34375L7.85938 6.5L13.0547 11.6953C13.2891 11.9297 13.2891 12.3594 13.0547 12.5938Z" fill="white"/>
</svg>
`,Vl=(e="#FFFFFF")=>`<svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.055 16.594a.662.662 0 0 1-.899 0L10 11.398l-5.195 5.196a.662.662 0 0 1-.899 0 .662.662 0 0 1 0-.899L9.102 10.5 3.906 5.344a.662.662 0 0 1 0-.899.662.662 0 0 1 .899 0L10 9.641l5.156-5.196a.662.662 0 0 1 .899 0 .662.662 0 0 1 0 .899L10.859 10.5l5.196 5.195a.662.662 0 0 1 0 .899Z" style="fill: ${e} !important;"
   /></svg>`,Yl=(e="#fff",t="")=>`<svg class="${t}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 3.532c0-1.554 1.696-2.514 3.029-1.715l14.113 8.468c1.294.777 1.294 2.653 0 3.43L7.029 22.183c-1.333.8-3.029-.16-3.029-1.715V3.532Z" fill="${e}"/></svg>`,Fl='<svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.797 16.664.648 9.204A1.071 1.071 0 0 1 .375 8.5c0-.195.078-.43.234-.625L7.758.415a.932.932 0 0 1 1.328-.04c.39.352.39.938.039 1.328L2.602 8.5l6.562 6.875a.932.932 0 0 1-.039 1.328.932.932 0 0 1-1.328-.039Z" fill="#090A0B"/></svg>',Gl='<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.804 6.563 6.902 2.661l.619-.619L12.478 7l-4.983 4.983-.619-.619 3.927-3.926H1.96v-.875z" fill="#fff" stroke="#fff"/></svg>',Kl=`<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="20 16 10 12" fill="none">
  <path d="M22.1274 28L28.1274 22L22.1274 16" stroke="#5C5C5C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,jl=(e="#fff",t="")=>`
<svg class="${t}" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g clipPath="url(#pauseIcon)">
    <path
      d="M4.375 2.5c-.633 0-1.125.516-1.125 1.125v6.75A1.11 1.11 0 0 0 4.375 11.5h.75c.61 0 1.125-.492 1.125-1.125v-6.75A1.14 1.14 0 0 0 5.125 2.5h-.75Zm4.5 0c-.633 0-1.125.516-1.125 1.125v6.75A1.11 1.11 0 0 0 8.875 11.5h.75c.61 0 1.125-.492 1.125-1.125v-6.75A1.14 1.14 0 0 0 9.625 2.5h-.75Z"
      fill="#fff"
    />
  </g>
  <defs>
    <clipPath id="pauseIcon">
      <path fill="${e}" d="M3 2.5h8v9H3z" />
    </clipPath>
  </defs>
</svg>
`,ql=({color:e="#fff",className:t=""}={})=>`<svg class="${t}" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Mute tolstoy video"><path d="M6.266 1.551a0.667 0.667 0 0 1 0.382 0.583v7.714c0 0.261 -0.161 0.482 -0.381 0.602a0.651 0.651 0 0 1 -0.703 -0.12L2.85 7.918h-1.346a1.269 1.269 0 0 1 -1.286 -1.286v-1.286c0 -0.703 0.562 -1.286 1.286 -1.286h1.346L5.563 1.671a0.651 0.651 0 0 1 0.703 -0.12Zm2.492 2.651 1.105 1.106 1.105 -1.106c0.18 -0.18 0.483 -0.18 0.663 0 0.201 0.201 0.201 0.502 0 0.683L10.526 5.991l1.106 1.104c0.201 0.201 0.201 0.502 0 0.683a0.44 0.44 0 0 1 -0.663 0l-1.106 -1.105 -1.104 1.106c-0.201 0.201 -0.502 0.201 -0.683 0 -0.201 -0.182 -0.201 -0.483 0 -0.684l1.105 -1.105L8.073 4.886c-0.2 -0.18 -0.2 -0.482 0 -0.683 0.182 -0.18 0.483 -0.18 0.684 0Z" fill="${e}"/></svg>`,zl=({color:e="#fff",className:t=""}={})=>`<svg class="${t}" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Unmute tolstoy video"><path d="M6.627 1.55c.238.101.411.342.411.583v7.714c0 .261-.173.482-.411.603a.742.742 0 0 1-.757-.121l-2.921-2.41H1.5c-.779 0-1.385-.563-1.385-1.286V5.347c0-.703.606-1.286 1.385-1.286h1.449l2.921-2.39a.742.742 0 0 1 .757-.121Zm3.721 1.447c.931.723 1.537 1.788 1.537 2.993 0 1.225-.606 2.29-1.537 2.993a.542.542 0 0 1-.735-.06c-.195-.201-.152-.502.065-.683.714-.522 1.168-1.326 1.168-2.25 0-.904-.454-1.708-1.168-2.23a.475.475 0 0 1-.065-.683.565.565 0 0 1 .735-.08ZM9.029 4.503c.476.362.779.884.779 1.487 0 .623-.303 1.145-.779 1.507a.55.55 0 0 1-.736-.081.454.454 0 0 1 .087-.663.966.966 0 0 0 .389-.763.928.928 0 0 0-.389-.743.475.475 0 0 1-.087-.683.57.57 0 0 1 .736-.061Z" fill="${e}"/></svg>`,hi=()=>`
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff0000" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
`,yi=()=>`
<svg width="40" height="20" xmlns="http://www.w3.org/2000/svg">
    <rect width="40" height="20" rx="3" ry="3" style="fill:blue;"/>
    <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="8" font-weight="normal" fill="white" letter-spacing="0.1px">
        Publish
    </text>
</svg>
`;class gi{constructor(t){y(this,"postMessage",t=>{var o;(o=this.broadcaster)==null||o.postMessage(t)});y(this,"addEventListener",(...t)=>{var o;(o=this.receiver)==null||o.addEventListener(...t)});this.name=t||_o();try{"BroadcastChannel"in self&&(this.broadcaster=new BroadcastChannel(this.name),this.receiver=new BroadcastChannel(this.name))}catch(o){console.error("self is not defined",o)}}}class No{constructor({shouldIncludeLogs:t=!1,shouldArchivePastEvents:o=!1}={}){y(this,"subscribeMultipleEvents",({eventNames:t,callback:o,shouldIncludePastEvents:s})=>{for(const n of t)this.subscribe({eventName:n,callback:o,shouldIncludePastEvents:s})});y(this,"unsubscribeMultipleEvents",({eventNames:t,callback:o})=>{for(const s of t)this.unsubscribe({eventName:s,callback:o})});this.broadcastHub=new gi,this.eventCallbacks={},this.pastEvents={},this.shouldIncludeLogs=t,this.shouldArchivePastEvents=o}logMessage(t){this.shouldIncludeLogs&&console.log(t)}throwError(t){if(this.shouldIncludeLogs)throw new Error(t)}archivePastEvent(t){if(!this.shouldArchivePastEvents)return;const{eventName:o}=t;this.pastEvents[o]||(this.pastEvents[o]=[]),this.pastEvents[o].push(t)}postMessage(t){this.archivePastEvent(t),this.broadcastHub.postMessage(t)}postPastEvents({eventName:t,callback:o}){if(this.pastEvents[t])for(const s of this.pastEvents[t])o({data:w(E({},s),{isPastEvent:!0})})}subscribe({eventName:t,callback:o,shouldIncludePastEvents:s}){if(this.eventCallbacks[t]||(this.eventCallbacks[t]=new Set),this.eventCallbacks[t].has(o)){this.throwError(`Already subscribed to event ${t} with this callback`);return}this.eventCallbacks[t].add(o),s&&this.postPastEvents({eventName:t,callback:o})}unsubscribe({eventName:t,callback:o}){if(!this.eventCallbacks[t]){this.throwError(`Not subscribed to event ${t}`);return}if(!this.eventCallbacks[t].has(o)){this.throwError("Callback is not subscribed");return}if(!this.eventCallbacks[t].delete(o)){this.logMessage(`Not subscribed to event ${t} with this callback`);return}this.logMessage(`Unsubscribed from event ${t}`)}initListener(t){this.broadcastHub.addEventListener("message",t)}}class J extends No{constructor(){if(J.instance)return J.instance;super({shouldArchivePastEvents:!0});y(this,"eventHandler",o=>{const{data:s={}}=o,{eventName:n}=s;if(this.eventCallbacks[n])for(const i of this.eventCallbacks[n])i(o)});y(this,"postMessage",o=>{const s=o.transmissionId||_o();return super.postMessage(w(E({},o),{transmissionId:s})),s});y(this,"init",()=>{this.initListener(this.eventHandler)});J.instance=this}}const u=new J;Object.freeze(u);const Ei={modalOpen:"tolstoyModalOpen",playerReady:"tolstoyPlayerReady",toggleFeedCloseButton:"toggleFeedCloseButton",showFeedProductModal:"showFeedProductModal",reportModalOpen:"tolstoyReportModalOpen",reportModalClose:"tolstoyReportModalClose",modalMessagingReady:"tolstoyModalMessagingReady",closePlayer:"tolstoyClosePlayer",userEmailUpdate:"tolstoyUserEmailUpdate"},mi={isRebuyAppInstalled:"tolstoyIsRebuyAppInstalled",openRebuyCart:"tolstoyOpenRebuyCart",rebuyCartShown:"rebuyCartShown",rebuyCartHidden:"rebuyCartHidden"},wi={openKendoModal:"tolstoyOpenKendoModal",changeZIndex:"tolstoyChangeZIndex"},fi={isTapcart:"tolstoyIsTapcart",openTapcartProduct:"tolstoyOpenTapcartProduct"},Si={getProductsMetafields:"getProductsMetafields",returnProductsMetafields:"returnProductsMetafields"},Ti={isAfterpayAppInstalled:"tolstoyIsAfterpayAppInstalled"},Ii={productCardClick:"tolstoyProductCardClick"},bi={spotlightCarouselQuickShopClick:"tolstoySpotlightCarouselQuickShopClick"},_i={externalEventSubscribed:"tolstoyExternalEventSubscribed",productCardClickSubscribed:"tolstoyProductCardClickSubscribed"},Ci={setAnonymousIdToCart:"tolstoySetAnonymousIdToCart",blockAnonymousIdToCart:"tolstoyBlockAnonymousIdToCart",addToCart:"tolstoyAddToCart",addToCartSuccess:"tolstoyAddToCartSuccess",addToCartError:"tolstoyAddToCartError",addToCartSoldOut:"tolstoyAddToCartSoldOut",addToCartDisableDefault:"tolstoyAddToCartDisableDefault",cartItemQuantityChange:"tolstoyCartItemQuantityChange",cartItemQuantityChangeSuccess:"tolstoyCartItemQuantityChangeSuccess",cartItemQuantityChangeError:"tolstoyCartItemQuantityChangeError",cartDataRequest:"tolstoyCartDataRequest",cartDataResponse:"tolstoyCartDataResponse"},vi={loginWithMultipassUrlRequest:"tolstoyLoginWithMultipassUrl",loginWithMultipassUrlResponse:"tolstoyLoginWithMultipassUrlResponseMessage"},Ai={productRecommendationsRequest:"tolstoyProductRecommendationsRequest",productRecommendationsResponse:"tolstoyProductRecommendationsResponse"},Oi={requestProductsUpdate:"tolstoyRequestProductsUpdate",productUpdateResponse:"tolstoyProductUpdateResponse",moveToUrl:"tolstoyMoveToUrl",isNonBaseCurrency:"tolstoyIsNonBaseCurrency"},Pi={urlChange:"urlChange",urlLocaleUpdate:"tolstoyUrlLocaleUpdate"},Ri={openCommerceSettingsUpdate:"tolstoyOpenCommerceSettingsUpdate"},a=w(E(E(E(E(E(E(E(E(E(E(E(E(E(E(E({},Ei),mi),wi),Ti),Si),Ii),bi),_i),fi),Ci),vi),Ai),Oi),Pi),Ri),{rejectCookiePolicy:"rejectCookiePolicy"}),Mi="Nunito Sans, sans-serif",Zl="tolstoy-custom-font-family",Xl="tolstoy-custom-heading-font-family",He=[];function Li(e,t){const o="italic",s="normal",n={".ttf":"truetype",".otf":"opentype",".woff":"woff",".woff2":"woff2"},i=document.createElement("style");for(const r of Object.keys(e)){const c=e[r],l=r.includes(o),d=r.split("-")[1]||r.replace(o,"")||s,g=l?o:s,p=Object.keys(n).find(A=>c.includes(A)),I=n[p],b=c.replace("http://","https://");i.append(document.createTextNode(`@font-face { font-family: '${t}'; src: url("${b}") format("${[I]}"); font-weight: ${d}; font-style: ${g}; font-display: swap;}`))}document.head.append(i)}const Uo=(e,t=1)=>{if(!(!e||t===3)){if(!document.querySelector("#tolstoyWidgetElement")){setTimeout(()=>{Uo(e,t+1)},1e3);return}document.querySelector("#tolstoyWidgetElement").style.fontFamily=`${e}, ${Mi}`}},Ni=e=>{const t=document.head.querySelectorAll("style");return Array.from(t).some(o=>o.textContent.includes(`@font-face { font-family: '${e}';`))};function xe(e,t="tolstoy-custom-font-family"){if(!e||He.includes(t)||Ni(t))return;const{sources:o}=e;Li(o,t),Uo(t),He.push(t)}let X,We="";const Ui=e=>{var o;const t=document.querySelector("#smile-ui-container");e&&(We=(t==null?void 0:t.style.display)||""),(o=t==null?void 0:t.style)==null||o.setProperty("display",e||We)},Di=e=>{let t=0;return o=>{try{o()}catch(s){try{fetch("https://api.gotolstoy.com/events/event",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({eventName:"widgetError",text:s.message,timestamp:new Date().toISOString(),parentUrl:window.location.href,appKey:e.data.appKey,publishId:e.data.publishId,sessionId:e.data.sessionId,source:e.data.name,answerKey:`${t}`,currentPageProductId:o.toString(),formData:`${(s&&s.stack||"").slice(0,1999)}`})})}catch(n){vo(n)}}finally{t++}}},ki=e=>{if(e.data.name===m.sessionStart||e.data.name===R.autoplayStart){const t=Di(e);t(()=>Hs(e.data.publishId)),t(()=>Zs(e.data.appKey)),t(()=>wo(e.data.sessionId)),t(()=>Js(e.data.publishId,e.data.sessionId)),t(()=>Ui("none")),t(()=>Bi(e.data.anonymousId))}},Bi=e=>{window.Shopify&&u.postMessage({eventName:a.setAnonymousIdToCart,anonymousId:e})},Ql=({data:{name:e,publishId:t,productIds:o}={}})=>{if(e===as)for(const s of o)xs({productId:s,publishId:t})},Jl=e=>{Ye[e.data.name]&&Ye[e.data.name](e.data)},td=e=>{Fe[e.data.name]&&setTimeout(()=>Fe[e.data.name](),500)},$i=()=>{var e,t;window.GorgiasChat&&((t=(e=window.GorgiasChat).open)==null||t.call(e),window.tolstoyWidget.hide(),document.head.insertAdjacentHTML("beforeend","<style>#gorgias-chat-container iframe#chat-button { visibility: visible !important; display: block !important; }</style>"))},Hi=()=>{var e,t;window.GorgiasChat&&((t=(e=window.GorgiasChat).close)==null||t.call(e),document.head.insertAdjacentHTML("beforeend","<style>#gorgias-chat-container iframe#chat-button { visibility: hidden; display: none; }</style>"))},xi=()=>{window.adaEmbed&&(window.adaEmbed.toggle(),window.tolstoyWidget.hide())},Wi=()=>{document.head.insertAdjacentHTML("beforeend","<style>#ada-button-frame { display: none; }</style>")},Vi=()=>{window.fcWidget&&(window.fcWidget.show(),window.fcWidget.open(),window.tolstoyWidget.hide())},Yi=()=>{window.fcWidget&&(window.fcWidget.close(),window.fcWidget.hide(),window.tolstoyWidget.show())},Fi=()=>{var e,t;if(!X&&((e=window.Reamaze)!=null&&e.popup)){window.Reamaze.popup(),window.tolstoyWidget.hide();return}window._support&&X&&((t=window.Reamaze)!=null&&t.reload)&&(window._support.ui=X,window.Reamaze.reload(),X=null,window.tolstoyWidget.hide())},Gi=()=>{var e,t;(e=window._support)!=null&&e.ui&&((t=window.Reamaze)!=null&&t.reload)&&(X=window._support.ui,delete window._support.ui,window.Reamaze.reload(),window.tolstoyWidget.show())},Ki=()=>{const e=setTimeout(()=>clearInterval(t),9e3),t=setInterval(()=>{window.Intercom&&(window.Intercom("show"),window.tolstoyWidget.hide(),clearInterval(t),clearTimeout(e),window.Intercom("onHide",()=>{window.tolstoyWidget.show()}))})},ji=()=>{const e=setTimeout(()=>clearInterval(t),9e3),t=setInterval(()=>{window.Intercom&&(window.Intercom("update",{hide_default_launcher:!0}),clearInterval(t),clearTimeout(e))},100)},qi=()=>{window.Tawk_API&&(window.Tawk_API.maximize(),window.tolstoyWidget.hide())};function zi(){window.Tawk_API&&window.Tawk_API.hideWidget()}const Zi=()=>{window.LiveChatWidget&&(window.LiveChatWidget.call("maximize"),window.tolstoyWidget.hide())};function Xi(){window.LiveChatWidget&&window.LiveChatWidget.call("hide")}const Qi=()=>{window.HubSpotConversations&&window.HubSpotConversations.widget&&(window.HubSpotConversations.widget.open(),window.tolstoyWidget.hide())};function Ji(){window.HubSpotConversations&&window.HubSpotConversations.widget&&window.HubSpotConversations.widget.close()}const tr=()=>{window.Beacon&&(window.Beacon("open"),window.tolstoyWidget.hide(),window.Beacon("config",{display:{zIndex:"99999"}}))},er=()=>{window.Beacon&&window.Beacon("config",{display:{zIndex:"0"}})},or=()=>{window.drift&&(window.drift.api.toggleChat(),window.tolstoyWidget.hide())},sr=()=>{window.drift&&window.drift.api.widget.hide()},nr=()=>{var e,t;window.zE&&(window.zE("messenger","open"),(t=(e=document.querySelector('[title="Button to launch messaging window"]'))==null?void 0:e.style)==null||t.setProperty("display","block"),window.tolstoyWidget.hide())},ir=()=>{const e=setTimeout(()=>clearInterval(t),5e3),t=setInterval(()=>{var n,i,r;const o=document.querySelector('[title="Button to launch messaging window"]'),s=document.querySelector('[title="Message from company"]');(n=o==null?void 0:o.style)==null||n.setProperty("display","none"),(r=(i=s==null?void 0:s.parentElement)==null?void 0:i.style)==null||r.setProperty("display","none"),o&&s&&(clearInterval(t),clearTimeout(e))},100);window.zE&&window.zE("messenger","close")},rr=()=>{window.tidioChatApi&&(window.tidioChatApi.show(),window.tidioChatApi.open(),window.tolstoyWidget.hide())},ar=()=>{window.tidioChatApi&&window.tidioChatApi.close()},cr=e=>{if(window.certainly)switch(window.certainly.widgetStatus({action:"open"}),window.tolstoyWidget.hide(),e.data.key){case"PmkMI":window.certainly.goTo({module:"670442"});break;case"_23Hl":window.certainly.goTo({module:"670178"});break;case"P9rfq":window.certainly.goTo({module:"670179"});break}},lr=()=>{window.certainly&&window.certainly.widgetStatus({action:"hide"})},Ve=e=>{document.head.insertAdjacentHTML("beforeend",`<style>${e} { visibility: hidden; display: none; }</style>`)},dr=()=>{Ve("#vfChat+div"),Ve("#vfChat+div+div")},ur="tolstoyHideFreshChat",pr="tolstoyOpenFreshChat",hr="tolstoyHideReamaze",yr="tolstoyOpenReamaze",gr="tolstoyHideAda",Er="tolstoyOpenAda",mr="tolstoyHideTidio",wr="tolstoyOpenTidio",fr="tolstoyHideCertainly",Sr="tolstoyOpenCertainly",Tr="tolstoyHideVfChat",Ye={[m.openGorgias]:$i,[m.openIntercom]:Ki,[m.openTawkTo]:qi,[m.openLiveChat]:Zi,[m.openHubSpot]:Qi,[m.openDrift]:or,[m.openZendesk]:nr,[m.openHelpScout]:tr,[pr]:Vi,[yr]:Fi,[Er]:xi,[wr]:rr,[Sr]:cr},Fe={[m.hideGorgias]:Hi,[m.hideIntercom]:ji,[m.hideTawkTo]:zi,[m.hideLiveChat]:Xi,[m.hideHubSpot]:Ji,[m.hideDrift]:sr,[m.hideZendesk]:ir,[m.hideHelpScout]:er,[ur]:Yi,[hr]:Gi,[gr]:Wi,[Tr]:dr,[mr]:ar,[fr]:lr};class Ir{constructor({config:t,playerType:o,collectionId:s}){this.config=t,this.publishId=t.publishId,this.playerType=o,this.sessionId=Nt()||vt(),this.anonymousId=Lt(),this.currentPageProductId=Ut(),this.collectionId=s,this.errors={}}getIsMobile(){return window.screen.width<=450||window.screen.height<=450}getAnalyticsParams(t={}){var d;const{id:o,appKey:s,name:n,googleAnalyticsID:i}=this.config,r=window.location.href.split("?")[0],c=(d=window.Shopify)==null?void 0:d.shop,l=this.errors;return E({appKey:s,publishId:this.publishId,sessionId:this.sessionId,anonymousId:this.anonymousId,currentPageProductId:this.currentPageProductId,isMobile:this.getIsMobile(),pageUrl:r,storeUrl:c,appUrl:c,googleAnalyticsID:i,projectId:o,playlist:n,timestamp:new Date().toISOString(),parentUrl:window.location.href,playerType:this.playerType,customParams:l?JSON.stringify(l):void 0,collectionId:this.collectionId},t)}sendEventToAllSources(t){ie(t),Wt({data:w(E({},t),{name:t.eventName})})}sendEventImmediately(t={},o=!1){const s=this.getAnalyticsParams(t);Po(s),!o&&Wt({data:w(E({},s),{name:s.eventName})})}sendEvent(t={},o=!1){const s=this.getAnalyticsParams(t);s.eventName===f.onYouClick&&console.log("Analytics::sendEvent::params",s),ie(s),!o&&Wt({data:w(E({},s),{name:s.eventName})})}handlePageView(){Vt(this.publishId,!1),this.sendEvent({eventName:f.pageView})}handleEmbedView(){Vt(this.publishId,!0),this.sendEvent({eventName:f.embedView})}handleOnYouClick(){Vt(this.publishId,!0),wo(this.sessionId),this.sendEvent({eventName:f.onYouClick})}handleSessionStart(){const t=this.getAnalyticsParams({eventName:f.sessionStart});this.sendEventToAllSources(t),ki({data:w(E({},t),{name:m.sessionStart})}),window.postMessage(w(E({},t),{name:m.sessionStart}),"*")}handleVideoLoaded(t={}){const o=this.getAnalyticsParams(w(E({},t),{eventName:f.videoLoaded}));this.sendEventToAllSources(o)}handleVideoWatched(t={}){const o=this.getAnalyticsParams(w(E({},t),{eventName:f.videoWatched}));this.sendEventToAllSources(o)}}const Yt={A:"A",B:"B"};class br{constructor(t){this.widgetType=t}sendAbTestInitializedEvent({abTestId:t,group:o,excludeExternalAnalytics:s,probability:n}){const i={abTestId:t,eventName:f.abTestInitialized,sessionUniqueId:ge(),testGroup:o,probability:n};this.analytics.sendEventImmediately(i,s)}initializeGroup({abTestId:t,probability:o,excludeExternalAnalytics:s}){const n=sn(t);if(n){this.group=n;return}const r=Math.random()>o?Yt.B:Yt.A;this.group=r,this.sendAbTestInitializedEvent({abTestId:t,group:r,excludeExternalAnalytics:s,probability:o}),on(t,r)}init(t){if(!t)return;const{abTestSettings:o={}}=t,{isEnabled:s,abTestId:n,probability:i,groupASettings:r={},groupBSettings:c={},excludeExternalAnalytics:l}=o;if(s)return this.analytics=new Ir({config:t,playerType:this.widgetType}),this.initializeGroup({abTestId:n,probability:i,excludeExternalAnalytics:l}),this.group===Yt.A?r:c}}const ed=".webp",od={VIDEO:"video",IMAGE:"image",GALLERY:"gallery"},Z={XS:250,S:480,M:960,L:1280,XL:1920},sd={[Z.XS]:"_250",[Z.S]:"_480",[Z.M]:"_960",[Z.L]:"_1280",[Z.XL]:"_1920"},Do={"250x140":"250x140","250x250":"250x250","480x480":"480x480","960x540":"960x540"},ko=({path:e=`${no}/public`,ownerId:t="",assetId:o="",suffix:s="",extension:n=""})=>`${e}/${t}/${o}/${o}${s}${n}`,nd=({stockAsset:e={},posterSettings:t={}})=>{const{useShopifyPoster:o=!0}=t,{shopifyPosterUrl:s,posterUrl:n}=e||{};return s&&o?s:n},_r=({step:e,extension:t,posterSettings:o,size:s=Do["250x250"],custom:n={condition:"",callback:""},path:i=`${no}/public`})=>{var K;const{videoOwner:r,videoId:c,stockAsset:l={},mediaAssets:d}=e;if(!c)return"";const{avatarUrl:g,posterUrl:p,hasOriginal:I,shopifyPosterUrl:b}=l||{},{shopifyAttributes:A={},shopifySpotlightAttributes:W={},useShopifyPoster:k=!1}=o||{},G=E(E({},A),W),yt=!!((K=Object.keys(G))!=null&&K.length),Se=b&&k&&yt;if(p)return p;if(d&&(d!=null&&d.images)&&(d!=null&&d.images[s])&&!Se)return d.images[s];const gt=!I&&(g||p);if(b&&!1){let j="width=300";return k&&(j=new URLSearchParams(G).toString()),`${b}&${j}`}return p!=null&&p.endsWith(t)||p&&!I?p:n!=null&&n.condition&&(n!=null&&n.callback)&&n.condition({posterUrl:p,avatarUrl:g,extension:t,isDuplicated:gt})?n.callback(l):ko({path:i,ownerId:r,assetId:c,extension:t})},Cr=".avatar.0000000.webp",vr=".401.0000000.webp",id=".avatar.0000000.jpg",rd=".0000000.jpg",Ar=480,Or=({isMobile:e,isStory:t,isPlayInTileFirst:o,isTile:s})=>o||s?"_640.mp4":e||t?"_preview.mp4":"_preview_embed.mp4",Ge=({step:e,isStory:t,isPlayInTileFirst:o,height:s=us,isTile:n})=>{const{videoOwner:i,stockAsset:r,videoId:c}=e,l=window.innerWidth<=450,d=Or({isMobile:l,isStory:t,isPlayInTileFirst:o,isTile:n}),g=r==null?void 0:r.videoUrl,p=!!(r!=null&&r.shopifyFileId),I=r==null?void 0:r.previewUrl,b=r==null?void 0:r.hasOriginal,A=r==null?void 0:r.gifUrl,W=p&&!b;return I&&!o&&s<Ar&&!n?I:g&&p?g:g&&!p?g!=null&&g.includes("vimeo")?g:`${g.split(".mp4")[0]}${d}`:A&&W?`${A.split(".mp4")[0]}${d}`:ko({ownerId:i,assetId:c,extension:d})},ad=(e,t,o=Do["480x480"])=>{const n=window.innerWidth<=450?Cr:vr;return _r({step:e,extension:n,posterSettings:t,size:o})},cd=(e,t)=>{const o=()=>{if(e.autoplay){e.src="";return}e.src=t};e.addEventListener("ended",o,{once:!0})},Pr=(e,t,o)=>o?`${e}-${t}-${o}`:`${e}-${t}`,ld=e=>e.dataset.publishId?e.dataset.publishId:e.id?e.id.split("_")[0]:"",dd=e=>{var t;return(t=e==null?void 0:e.dataset)==null?void 0:t.collectionId},ud=e=>{var s,n,i,r,c,l;const t=(i=(n=(s=e==null?void 0:e.design)==null?void 0:s.branding)==null?void 0:n.typography)==null?void 0:i.font,o=(l=(c=(r=e==null?void 0:e.design)==null?void 0:r.branding)==null?void 0:c.typography)==null?void 0:l.fontHeading;!(t!=null&&t.family)&&!(o!=null&&o.family)||(t!=null&&t.family&&xe(t),o!=null&&o.family&&xe(o,"tolstoy-custom-heading-font-family"))},pd=({step:e,embedMotion:t,isStory:o,loadAll:s=!1,isCarouselPlayInTileFirst:n})=>{if(t===Q.static||n)return null;const r=window.innerWidth<=450,c=t===Q.hoverOver,l=t===Q.dynamic;return l&&s?Ge({step:e,isStory:o}):c&&r||l?null:Ge({step:e,isStory:o})},Rr=e=>{const t=e.getBoundingClientRect();return t.top>=-t.height&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},Bo=(e,t)=>window.document.querySelectorAll(`[data-tolstoy-element="${Pr(e,t)}"]`),Mr=({videoClass:e,publishId:t,removeEventListenerFunction:o})=>{const s=Bo(e,t);for(const n of s)n.pause(),o==null||o(n)},Lr=({videoClass:e,publishId:t,setIsDynamicVideoRunning:o,onVideoEnd:s})=>{o(!1),Mr({videoClass:e,publishId:t,removeEventListenerFunction:n=>{n.removeEventListener("ended",s)}})},hd=({videoClass:e,isDynamicVideoRunning:t,setIsDynamicVideoRunning:o,dynamicVideoHandler:s,publishId:n,onVideoEnd:i})=>{const r=Bo(e,n);if(r.length===0)return;const c=Rr(r[0]);!c&&t?(Lr({videoClass:e,publishId:n,setIsDynamicVideoRunning:o,onVideoEnd:i}),o(!1)):c&&!t&&(s(),o(!0))},yd=r=>h(void 0,[r],function*({publishId:e,productId:t,widgetType:o,tags:s,appUrl:n,variantId:i}){const c=t&&t!==bs?Nn:Ln,l=window.tolstoyAppKey||v()||"",d=new URLSearchParams(window.location.search),g=i||d.get("variant"),p=yield c({productId:t,defaultPublishId:e,widgetType:o,appKey:l,tags:s,appUrl:n,variantId:g});return(new br(o).init(p)||{}).hideElement?{disabled:!0}:(p!=null&&p.disabled||(un({config:p,featureKey:dn})&&u.postMessage({eventName:a.blockAnonymousIdToCart,appKey:l}),p!=null&&p.openCommerceSettings&&u.postMessage({eventName:a.openCommerceSettingsUpdate,openCommerceSettings:p.openCommerceSettings})),p)});function gd(e,t){return!!(t==null?e:!t)}const Ed=e=>{const t=c=>{const l=di(c);return l.style.verticalAlign="middle",l.style.margin="0 5px",l.style.marginBottom="3px",l},o=document.createElement("p"),s=t(hi()),n=t(yi());return o.append(s),({"Invalid publishId":["Add the publish ID from the",n,"tab of your project in Tolstoy"],"Project is not live":["Your project is in draft. Publish project in the",n," tab of your project in Tolstoy"],"Project is deleted":["Project has been deleted"],"No videos found":["Select videos in the Videos tab of your project in Tolstoy"],"No filtered videos found":["Select videos in the Videos tab of your project in Tolstoy"],"No connections found":["Select videos in the Videos tab of your project in Tolstoy"],"No videos found for product":["Add tagged videos for this product in the Videos tab of your project in Tolstoy"]}[e]||["Couldn't find product page"]).forEach(c=>{typeof c=="string"?o.append(document.createTextNode(c)):o.append(c)}),o},Nr=({element:e})=>{const t=e.getBoundingClientRect();return t.width===0||t.height===0?!1:t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},md=()=>new URLSearchParams(window.location.search).get("variant"),Ft="data-status",Ur=[Ct],wt={loading:"loading",loaded:"loaded",failed:"notFound"},Dr=({element:e,callback:t,outOfViewCallback:o})=>{const s=new window.IntersectionObserver(n=>{n[0].isIntersecting===!0&&n[0].intersectionRatio>.9?(o||s.unobserve(e),t()):n[0].intersectionRatio<.1&&(o==null||o())},{threshold:[.1,.9]});s.observe(e)};class kr{constructor({name:t,component:o,elementClassname:s}){this.name=t,this.Component=o,this.widgets=[],this.initialized=!1,this.elementClassname=s}init(){return h(this,null,function*(){const t=this.getElements();if(t.length!==0){for(const o of t)if(this.getShouldInitializeElement(o)){this.setElementStatus(o,wt.loading);try{const s=new this.Component;if(yield s.init(o),!s.getIsInitialized()){this.setElementStatus(o,wt.failed);continue}this.widgets.push(s),this.initializeEvents({element:o,widget:s}),this.setElementStatus(o,wt.loaded)}catch(s){this.setElementStatus(o,wt.failed),console.log(`error starting  tolstoy ${this.name}`,o.id,s)}}this.widgets.length>0&&(this.initialized=!0)}})}deleteElementStatus(t){delete t.removeAttribute(Ft)}getElementStatus(t){return t.getAttribute(Ft)}getIsTolstoyPreview(){return window.tolstoyPreview}getIsElementHidden(t){var o;return((o=window.getComputedStyle(t))==null?void 0:o.display)==="none"||!t.offsetParent}setElementStatus(t,o){return t.setAttribute(Ft,o)}getShouldInitializeElement(t){return t.classList.contains(Xe)&&!this.getElementStatus(t)?!0:!this.getElementStatus(t)&&!this.getIsElementHidden(t)||!this.getElementStatus(t)&&dt()||this.getIsTolstoyPreview()}setComponent(t){this.Component=t}getElements(){return Ur.includes(this.name)?[document.querySelector(`.${this.elementClassname}`)].filter(Boolean):document.querySelectorAll(`.${this.elementClassname}`)}shouldLoad(){return this.getElements().length>0}initializeEvents({element:t,widget:o}){var s;(s=o.handlePageView)==null||s.call(o),this.registerEmbedViewListener({element:t,callback:o.handleView,outOfViewCallback:o.handleOutOfView})}registerEmbedViewListener({element:t,callback:o,outOfViewCallback:s}){Nr({element:t})&&(o(),!s)||Dr({element:t,callback:o,outOfViewCallback:s})}}let Ke=!1;const $o=()=>h(void 0,null,function*(){if(Ke)return;(yield C(()=>import("./4cfd275ac/widget.events.54c01207.js"),[])).initializeWidgetEvents(),Ke=!0});class Br{constructor(){y(this,"loadEmbedWidgets",()=>h(this,null,function*(){const t=Object.entries(this.embedWidgetsMap).map(r=>h(this,[r],function*([o,{embedWidget:s,loaded:n,loading:i}]){if(s.shouldLoad()){if(i){setTimeout(()=>this.loadEmbedWidgets(),2e3);return}n||(yield this.loadEmbedWidget({embedWidgetName:o,embedWidget:s})),yield s.init()}}));yield Promise.all(t)}));y(this,"handleUrlChange",()=>{for(const t of Object.keys(this.embedWidgetsMap))this.embedWidgetsMap[t].loaded=!1;this.loadEmbedWidgets()});this.domUpdatesListenerInitialized=!1,this.widgets=[],this.embedWidgetsMap={}}init(){return h(this,null,function*(){const t=[],o=[Qt,Jt,te,ee,Ct];for(const s of o){const n=eo[s],i=new kr({name:s,elementClassname:n});this.embedWidgetsMap[s]={embedWidget:i,loaded:!1},t.push(n)}this.registerDomUpdatesListenerIfNeeded(t),this.subscribeToUrlChange(),yield this.loadEmbedWidgets()})}loadEmbedWidget(s){return h(this,arguments,function*({embedWidgetName:t,embedWidget:o}){this.embedWidgetsMap[t].loading=!0;let n;switch(t){case Qt:{n=yield C(()=>import("./4cfd275ac/carousel-loader.b0445203.js"),[]);break}case Jt:{n=yield C(()=>import("./4cfd275ac/story.adb99bcc.js"),["4cfd275ac/modal.f2eb2931.css","4cfd275ac/story.28102514.css"]);break}case te:{n=yield C(()=>import("./4cfd275ac/embed.68417244.js"),["4cfd275ac/modal.f2eb2931.css","4cfd275ac/embed.550ffe5d.css"]);break}case ee:{n=yield C(()=>import("./4cfd275ac/tile.30c48056.js"),["4cfd275ac/tile.4607c378.css"]);break}case Ct:{n=yield C(()=>import("./4cfd275ac/collection-tile-controller.45aab9d7.js"),["4cfd275ac/collection-tile-controller.da37b89c.css"]);break}case to:{n=yield C(()=>import("./4cfd275ac/collection-page-tile-controller.ee9bba6f.js"),["4cfd275ac/collection-page-tile-controller.5d04a287.css"]);break}}o.setComponent(n.default),yield $o(),this.embedWidgetsMap[t].loaded=!0,this.embedWidgetsMap[t].loading=!1})}registerDomUpdatesListenerIfNeeded(t){if(this.domUpdatesListenerInitialized)return;Lo({classNames:t,callback:()=>this.loadEmbedWidgets()}),this.domUpdatesListenerInitialized=!0}subscribeToUrlChange(){u.subscribe({eventName:a.urlChange,callback:this.handleUrlChange})}}const B=Qe,$r=new Set(["5bzilmwoe1fon","z7uu0kcyzumt0"]),Ho=e=>$r.has(e)?Je:B;class Hr{constructor(){this.initialized=!1,this.widgets=[],this.start=this.start.bind(this),this.startPart=this.startPart.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.on=this.on.bind(this),this.recreate=this.recreate.bind(this),window.tolstoyWidget=w(E({},window.tolstoyWidget),{start:this.start,startPart:this.startPart,show:this.show,hide:this.hide,on:this.on,recreate:this.recreate})}init(n){return h(this,arguments,function*({bubbleSettings:t,widgetId:o,Component:s}){var c,l;this.bubbleSettings=t;const i=new s(t);if(yield i.init(),this.widgets.push(i),this.updateViewerIdentifyAttributes(),(c=window.tolstoySettings)!=null&&c.noReload||this.registerEvents(),(((l=window.tolstoySettings)==null?void 0:l.alwaysShow)||mo(o)!=="true")&&!t.exitIntentPublishId){const d=Ho(o);this.show(d),this.recreate(o,d)}else this.hide()})}updateViewerIdentifyAttributes(){const t=Number(go()||0)+1;qs(t.toString()),Eo()||zs(new Date().toISOString())}handleMouseDown(){this.userInteracted=!0,document.removeEventListener("mousedown",this.handleMouseDown)}registerEvents(){document.addEventListener("mousedown",()=>{this.handleMouseDown()}),document.body.addEventListener("mouseleave",()=>h(this,null,function*(){var s;const t=(s=this.bubbleSettings)==null?void 0:s.exitIntentPublishId;if(t&&this.userInteracted){const n=this.widgets.find(i=>{var r;return(r=i==null?void 0:i.bubbleSettings)==null?void 0:r.exitIntentPublishId});n&&(yield this.recreate(t,n.name,{startPlayerImmediately:!0}))}}))}start(t=B){const o=V(this.widgets,t);o&&o.start()}startPart(t,o=B){const s=V(this.widgets,o);s&&s.startPart(t)}hide(t=B){const o=V(this.widgets,t);o&&o.hide()}show(t=B){const o=V(this.widgets,t);o&&o.show()}on(t,o,s=B){const n=V(this.widgets,s);n&&n.eventChange(t,o)}recreate(t,o=B,s={}){const n=V(this.widgets,o);n&&n.recreate(t,s)}}const V=(e,t)=>e.find(o=>o.name===t);class xo{addHours(t,o=new Date){return o.setTime(o.getTime()+t*60*60*1e3),o}getTolstoyViewers(){const t=Ht();for(const[s,n]of Object.entries(t)){const i=n.restrictionLimits;!i||!(i!=null&&i.time&&new Date(i==null?void 0:i.time)<=new Date)||delete t[s].restrictionLimits}const o=JSON.stringify(t);return xt(t),o}updateRestrictions(t,o){var r;const s=Ht(),n=(r=s[o])==null?void 0:r.restrictionLimits;if(!n||(n==null?void 0:n.type)!==t)return;const i=n[t];n[t]=i?i+1:1,n.limit&&n.clickLimit===n[t]&&(n.time=this.addHours(n==null?void 0:n.limit)),s[o].restrictionLimits=n,xt(s)}updateRules(t){const o=(t==null?void 0:t.publishId)||void 0,s=t==null?void 0:t.limit,n=Ht();let i=n[o];const r=i==null?void 0:i.restrictionLimits;i?i.impressionCount+=1:i={impressionCount:1,playCount:0};let c=n.undefined;if(c?c.impressionCount+=1:c={impressionCount:1,playCount:0},s){let l={limit:Number(s.timeLimit),type:s.type,clickLimit:Number(s.clickLimit)};r&&(l=E(E({},r),l)),i.restrictionLimits=l}else r&&(i.restrictionLimits=null);n[o]=i,n.undefined=c,xt(n)}}class Pt{static isValidUrl(t){return t?t.startsWith("tel:")||t.startsWith("mailto:")?!0:t.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)!==null:!1}static isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}static isInIframe(){try{return window.self!==window.top}catch(t){return!0}}static isIos(){return/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}static getMobileOperatingSystem(){const t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?"iOS":navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?"ipad":null}static isMobile(){return Pt.getMobileOperatingSystem()!=null}static isSafari(){return window.safari!==void 0}static enforceProtocol(t,o="https"){return t.startsWith("http")||t.startsWith("//")||t.startsWith("tel:")||t.startsWith("mailto:")?t:`${o}://${t}`}static removeProtocol(t){return t.replace(/(^\w+:|^)\/\//,"")}static stripUrl(t){return Pt.removeProtocol(t).replace(/^www./,"").replace(/\/$/,"")}}class tt{constructor(){var t;if(tt.instance)return tt.instance;tt.instance=this,this.appKey=v(),this.shop=((t=window.Shopify)==null?void 0:t.shop)||Dt(),this.accountSettings=null,this.rules=new xo,this.shouldUseCache=null,this.cacheVersion=null,this.hasLiveBubble=null}init(){return h(this,null,function*(){var t,o,s;if(!(!this.appKey&&!this.shop)){if(this.accountSettings)return this.accountSettings;try{this.accountSettings=yield Rn(),this.rules.updateRules(this.accountSettings),(((t=this.accountSettings)==null?void 0:t.shouldUseCache)||fo())&&(window.tolstoySettings=window.tolstoySettings||{},window.tolstoySettings.shouldUseCache=!0);const i=((o=this.accountSettings)==null?void 0:o.cacheVersion)||x();return i&&(window.tolstoySettings=window.tolstoySettings||{},window.tolstoySettings.cacheVersion=i),this.hasLiveBubble=((s=this.accountSettings)==null?void 0:s.hasLiveBubble)||!!window.tolstoyWidgetId||Sn(),this.accountSettings}catch(n){return vo("Error loading account settings"),null}}})}}const Wo=new tt;class xr{constructor(){y(this,"getBubbleSettings",()=>h(this,null,function*(){var c;const t=window.location.href,o=((c=window.Shopify)==null?void 0:c.shop)||Dt();if(!this.appKey&&!o)return;const s=Ks(),n=this.rules.getTolstoyViewers(),i=o||window.location.host,r={timestamp:Date.now(),url:t,sessionCount:Number(go()||0),lastSeenAt:new Date().toISOString(),firstSeenAt:Eo(),tolstoySeenCounter:n,isMobile:Pt.isMobile(),domain:i,appUrl:o,appKey:this.appKey};s&&(r.identifyInfoId=s);try{const l=yield Un(r);return l?(this.rules.updateRules(l),l):null}catch(l){return null}}));y(this,"init",()=>h(this,null,function*(){var r,c,l,d;if(!((r=this.account)!=null&&r.hasLiveBubble))return;const t=yield this.getBubbleSettings();this.subscribeToUrlChange();const o=window.tolstoyWidgetId||(t==null?void 0:t.publishId)||(t==null?void 0:t.exitIntentPublishId);if(!o){(l=(c=this.widget)==null?void 0:c.hide)==null||l.call(c);return}if(!((d=window.tolstoySettings)==null?void 0:d.alwaysShow)&&mo(o)==="true")return;const n=Ho(o);let i;n===Je?i=yield C(()=>import("./4cfd275ac/centered-modal.e9cc74c8.js"),["4cfd275ac/modal.f2eb2931.css"]):n===Qe&&(i=yield C(()=>import("./4cfd275ac/bubble.cc96213a.js"),["4cfd275ac/modal.f2eb2931.css","4cfd275ac/bubble.4d99fbce.css"])),yield $o(),this.widget?(this.widget.recreate(o,n),this.widget.show()):(this.widget=new Hr,yield this.widget.init({bubbleSettings:t,widgetId:o,Component:i.default}))}));y(this,"handleUrlChange",()=>{this.unsubscribeFromUrlChange(),this.init()});this.account=Wo,this.rules=new xo,this.appKey=v()}subscribeToUrlChange(){u.subscribe({eventName:a.urlChange,callback:this.handleUrlChange})}unsubscribeFromUrlChange(){u.unsubscribe({eventName:a.urlChange,callback:this.handleUrlChange})}}const Wr={tvContainer:"tolstoy-video-page"},Vr="tolstoy-tv-container",wd="tolstoy-tv",fd={};class Yr{constructor(){this.domUpdatesListenerInitialized=!1,this.loaded=!1}init(){return h(this,null,function*(){yield this.loadVideo(),!this.loaded&&this.registerDomUpdatesListenerIfNeeded()})}loadVideo(){return h(this,null,function*(){const t=document.querySelector(`#${Vr}`);if(!t)return;const o=(yield C(()=>import("./4cfd275ac/tv.fe07d8c9.js"),["4cfd275ac/tv.b3115630.css"])).default;new o({tolstoyContainer:t}).init(),this.loaded=!0})}registerDomUpdatesListenerIfNeeded(){if(this.domUpdatesListenerInitialized)return;const t=[Wr.tvContainer];Lo({classNames:t,callback:()=>this.loadVideo()}),this.domUpdatesListenerInitialized=!0}}const Fr=[a.urlChange],Gr=e=>{switch(e.data.eventName){case a.urlChange:return Ro();default:return null}},Kr=["(+https://whatis.contentkingapp.com)","Shopify-Observe-Synthetic-Checks","+http://www.google.com/bot.html","https://naver.me/spd","HeadlessChrome","(+http://www.facebook.com/externalhit_uatext.php)","Bytespider","bot"],jr=()=>Kr.some(e=>window.navigator.userAgent.includes(e)),$={addToCart:"tolstoy_add_to_cart",spotlightCarouselQuickShopClick:"tolstoy_spotlight_carousel_quick_shop_click",productCardClick:"tolstoy_product_card_click"},S={addToCartSuccess:"tolstoy_add_to_cart_success",addToCartError:"tolstoy_add_to_cart_error",rejectCookiePolicy:"tolstoy_reject_cookie_policy",tolstoyZIndexChange:"tolstoy_z_index_change",urlLocaleUpdate:"tolstoy_url_locale_update",productUpdate:"tolstoy_product_update"},Vo=Object.values($),qr=new Set([S.addToCartSuccess,S.addToCartError,S.rejectCookiePolicy,S.tolstoyZIndexChange,S.urlLocaleUpdate,S.productUpdate]),zr=({eventName:e,callback:t})=>{if(!Vo.includes(e)){console.error(`Event ${e} is not a valid event`);return}if(!t){console.error("Callback must be provided");return}if(typeof t!="function"){console.error("Callback must be a function");return}return!0};class et extends No{constructor(){if(et.instance)return et.instance;super({shouldIncludeLogs:!0});y(this,"eventHandler",({data:o={}})=>{const{eventName:s}=o;if(this.eventCallbacks[s])for(const n of this.eventCallbacks[s])try{n(o)}catch(i){console.error(i)}});y(this,"subscribe",(o,s,n={})=>{if(zr({eventName:o,callback:s}))try{super.subscribe({eventName:o,callback:s}),u.postMessage({eventName:a.externalEventSubscribed,subscribedEventName:o,payload:n});const i=new CustomEvent("TOLSTOY_WIDGET_V2_SUBSCRIBE",{detail:{eventName:o,payload:n,callback:s}});window.dispatchEvent(i),console.log("Subscribed to event",o)}catch(i){console.error(i)}});y(this,"unsubscribe",(o,s)=>super.unsubscribe({eventName:o,callback:s}));y(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Vo,callback:this.eventHandler})});et.instance=this}init(){this.initInternalMessagingSubscriptions(),this.initListener(this.eventHandler)}}const _t=new et;Object.freeze(_t);const Zr=e=>{const{eventName:t}=e;if(!t){console.error("eventName is required");return}if(!qr.has(t)){console.error(`${t} is not a valid eventName`);return}return!0};class Xr{constructor(){y(this,"postMessage",(t={})=>{Zr(t)&&u.postMessage(t)})}closePlayer(){u.postMessage({eventName:a.closePlayer})}changeEmail(t){window.tolstoyUser=t,u.postMessage({eventName:a.userEmailUpdate,email:t})}identify(){return h(this,arguments,function*(t={}){var n;const{email:o,userId:s}=t;if(!o&&!s){console.error("No email or userId");return}try{o&&this.changeEmail(o),s&&(t.userId=s.toString()),t.appKey=v();const i=yield Mn(t);Gs(i==null?void 0:i.id)}catch(i){console.error("Error occurred while updating identify info:",i),(n=window.tolstoyCaptureError)==null||n.call(window,i,"Error occurred while updating identify info:"),js()}})}}const ae=new Xr;Object.freeze(ae);const Qr=[S.urlLocaleUpdate],Jr=({data:e})=>{switch(e.eventName){case S.urlLocaleUpdate:const{payload:t}=e;u.postMessage({eventName:a.urlLocaleUpdate,urlLocale:t.urlLocale});break;default:return null}};class ot{constructor(){if(ot.instance)return ot.instance;ot.instance=this}initExternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Qr,callback:Jr})}init(){this.initExternalMessagingSubscriptions();const t=window.history.pushState,o=window.history.replaceState;let s=window.location.href;const n=()=>{window.location.href!==s&&(s=window.location.href,u.postMessage({eventName:a.urlChange}))};window.history.pushState=function(){t.apply(window.history,arguments),n()},window.history.replaceState=function(){o.apply(window.history,arguments),n()}}}const Yo=new ot;Object.freeze(Yo);const ta=[a.modalOpen];class ea{constructor(){y(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.modalOpen:this.sendIsAfterpayAppInstalledMessage();return;default:return null}})}sendIsAfterpayAppInstalledMessage(){u.postMessage({eventName:a.isAfterpayAppInstalled,value:!!(window!=null&&window.Afterpay)})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:ta,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const Fo=new ea;Object.freeze(Fo);const oa=()=>{Ls(),Ms(Rt.rejected),u.postMessage({eventName:a.rejectCookiePolicy})},sa=[S.rejectCookiePolicy];class st{constructor(){y(this,"externalMessagingHandler",t=>{switch(t.data.eventName){case S.rejectCookiePolicy:return oa();default:return null}});y(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:sa,callback:this.externalMessagingHandler})});if(st.instance)return st.instance;st.instance=this}init(){this.initExternalMessagingSubscriptions()}}const Go=new st;Object.freeze(Go);const na={itemSoldOut:"itemSoldOut"},Ko={tolstoyAnonymousId:"__tolstoyAnonymousId"},ia=({description:e})=>{switch(e){case na.itemSoldOut:return a.addToCartSoldOut;default:return a.addToCartError}},ra=({data:e})=>{const{description:t}=e,o=ia({description:t});u.postMessage(w(E({},e),{eventName:o}))},aa=({data:e})=>{const{variantId:t,productId:o,transmissionId:s,quantity:n,productHandle:i,templateSuffix:r}=e;u.postMessage({variantId:t,productId:o,transmissionId:s,quantity:n,productHandle:i,eventName:$.addToCart,templateSuffix:r})},ca=({data:e})=>{const{product:t,transmissionId:o}=e;u.postMessage({product:t,transmissionId:o,eventName:$.spotlightCarouselQuickShopClick})},la=({data:e})=>{const{subscribedEventName:t,payload:o={}}=e,{disableDefault:s}=o;switch(t){case $.addToCart:case $.spotlightCarouselQuickShopClick:s&&u.postMessage({eventName:a.addToCartDisableDefault});break;default:return null}},da=({data:e})=>{u.postMessage(w(E({},e),{eventName:a.addToCartSuccess}))},ua=[a.addToCart,a.spotlightCarouselQuickShopClick,a.externalEventSubscribed],pa=[S.addToCartSuccess,S.addToCartError];class nt{constructor(){y(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.addToCart:return aa(t);case a.spotlightCarouselQuickShopClick:return ca(t);case a.externalEventSubscribed:return la(t);default:return null}});y(this,"externalMessagingHandler",t=>{switch(t.data.eventName){case S.addToCartSuccess:return da(t);case S.addToCartError:return ra(t);default:return null}});y(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:ua,callback:this.internalMessagingHandler})});y(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:pa,callback:this.externalMessagingHandler})});if(nt.instance)return nt.instance;nt.instance=this}init(){this.initInternalMessagingSubscriptions(),this.initExternalMessagingSubscriptions()}}const jo=new nt;Object.freeze(jo);const ha=[a.externalEventSubscribed,a.productCardClick],ya=({subscribedEventName:e,payload:t})=>{switch(e){case $.productCardClick:{const{disableProductModal:o=!0}=t;u.postMessage({eventName:a.productCardClickSubscribed,isDisableProductModal:o});break}default:return null}},ga=({data:e})=>{const{eventName:t}=e;switch(t){case a.externalEventSubscribed:{const{subscribedEventName:o,payload:s}=e;ya({subscribedEventName:o,payload:s});break}case a.productCardClick:{const{variantId:o,productId:s,externalProductIds:n,productHandle:i}=e;u.postMessage({eventName:$.productCardClick,variantId:o,productId:s,taggedProductIds:n,productHandle:i});break}default:return null}};class Ea{initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:ha,callback:ga})}init(){this.initInternalMessagingSubscriptions()}}const qo=new Ea;Object.freeze(qo);const ma=[a.getProductsMetafields];class wa{constructor(){y(this,"internalMessagingHandler",({data:t})=>{var o;switch(t.eventName){case a.getProductsMetafields:if(!((o=t==null?void 0:t.productIds)!=null&&o.length))return;u.postMessage({productsExtraData:this.getProductsMetafields(t.productIds),modalId:t.modalId,eventName:a.returnProductsMetafields});return;default:return null}})}getProductsMetafields(t=[]){var s,n;const o={};for(const i of t)o[i]=(n=(s=window==null?void 0:window.metafields)==null?void 0:s.products)==null?void 0:n[i];return o}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:ma,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const zo=new wa;Object.freeze(zo);const fa=[a.openRebuyCart],Gt={show:"rebuy:smartcart.show",hide:"rebuy:smartcart.hide",init:"rebuy:smartcart.init"};class Sa{constructor(){y(this,"sendIsRebuyAppInstalledMessage",()=>{var t,o;if(!((t=window==null?void 0:window.Rebuy)!=null&&t.SmartCart)){document.addEventListener(Gt.init,this.sendIsRebuyAppInstalledMessage,{once:!0});return}u.postMessage({eventName:a.isRebuyAppInstalled,value:!!((o=window==null?void 0:window.Rebuy)!=null&&o.SmartCart)}),this.initRebuyEventListeners()});y(this,"internalMessagingHandler",t=>{var o,s;switch(t.data.eventName){case a.openRebuyCart:return(s=(o=window==null?void 0:window.Rebuy)==null?void 0:o.SmartCart)==null?void 0:s.show();default:return null}})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:fa,callback:this.internalMessagingHandler})}initRebuyEventListeners(){document.addEventListener(Gt.show,()=>{u.postMessage({eventName:a.rebuyCartShown})}),document.addEventListener(Gt.hide,()=>{u.postMessage({eventName:a.rebuyCartHidden})})}init(){this.initInternalMessagingSubscriptions(),this.sendIsRebuyAppInstalledMessage()}}const Zo=new Sa;Object.freeze(Zo);const Ta=[a.openKendoModal];class Ia{constructor(){y(this,"internalMessagingHandler",t=>{var o,s;switch(t.data.eventName){case a.openKendoModal:u.postMessage({eventName:a.changeZIndex,zIndex:1e3}),(s=(o=window.KENDO)==null?void 0:o.openQuickModalByHandle)==null||s.call(o,t.data.productHandle);const n=t.data.quantity;if(n<=1)return;for(let i=1;i<n;i++)setTimeout(()=>{var c;const r=document.querySelector(".quantity-selector__action--increment");(c=r==null?void 0:r.click)==null||c.call(r)},1e3+i*150);return;default:return null}})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Ta,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const Xo=new Ia;Object.freeze(Xo);const ba=[a.addToCart,a.playerReady,a.productCardClick],_a={cartUpdated:"cart/updated"},Ca=({productId:e,variantId:t})=>{const o={productId:String(e)};return t&&(o.variantId=String(t)),window.Tapcart.actions.openProduct(o)},va=e=>{const o=setTimeout(()=>{u.postMessage(w(E({},e),{eventName:a.addToCartError}))},4e3);window.Tapcart.registerEventHandler(_a.cartUpdated,()=>{clearTimeout(o),u.postMessage(w(E({},e),{eventName:a.addToCartSuccess}))})},Aa=e=>h(void 0,null,function*(){const{variantId:t,productId:o}=e;try{va(e),window.Tapcart.actions.addToCart({lineItems:[{variantId:String(t||o),quantity:1}]})}catch(s){return u.postMessage(w(E({},e),{error:s,eventName:a.addToCartError}))}}),Oa=()=>{var e,t,o,s,n,i;try{const r=io();if(!r)return;const l=[...((o=(t=(e=window==null?void 0:window.Tapcart)==null?void 0:e.variables)==null?void 0:t.cart)==null?void 0:o.attributes)||[],{key:Ko.tolstoyAnonymousId,value:r}];(i=(n=(s=window==null?void 0:window.Tapcart)==null?void 0:s.actions)==null?void 0:n.updateCartAttributes)==null||i.call(n,{attributes:l})}catch(r){ie({text:r==null?void 0:r.message,parentUrl:window.location.href,appKey:v(),source:"tapcart",eventName:"widgetError",timestamp:new Date().toISOString()})}};class Pa{constructor(){y(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.playerReady:return this.disableCartDefault();case a.productCardClick:return Ca(t.data);case a.addToCart:return Aa(t.data);default:return null}})}disableCartDefault(){u.postMessage({eventName:a.addToCartDisableDefault})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:ba,callback:this.internalMessagingHandler})}init(){dt()&&(this.initInternalMessagingSubscriptions(),Oa())}}const Qo=new Pa;Object.freeze(Qo);const Jo={USD:"$",CAD:"CA$",EUR:"",AED:"..",AFN:"",ALL:"Lek",AMD:".",ARS:"$",AUD:"AU$",AZN:".",BAM:"KM",BDT:"",BGN:".",BHD:"..",BIF:"FBu",BND:"$",BOB:"Bs",BRL:"R$",BWP:"P",BYN:".",BZD:"$",CDF:"FrCD",CHF:"CHF",CLP:"$",CNY:"CN",COP:"$",CRC:"",CVE:"CV$",CZK:"K",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"..",EEK:"kr",EGP:"..",ERN:"Nfk",ETB:"Br",GBP:"",GEL:"GEL",GHS:"GH",GNF:"FG",GTQ:"Q",HKD:"$",HNL:"L",HRK:"kn",HUF:"Ft",IDR:"Rp",ILS:"",INR:"",IQD:"..",IRR:"",ISK:"kr",JMD:"$",JOD:"..",JPY:"",KES:"Ksh",KHR:"",KMF:"FC",KRW:"",KWD:"..",KZT:".",LBP:"..",LKR:"SL Re",LTL:"Lt",LVL:"Ls",LYD:"..",MAD:"..",MDL:"MDL",MGA:"MGA",MKD:"MKD",MMK:"K",MOP:"MOP$",MUR:"MURs",MXN:"MX$",MYR:"RM",MZN:"MTn",NAD:"N$",NGN:"",NIO:"C$",NOK:"kr",NPR:"",NZD:"$",OMR:"..",PAB:"B/.",PEN:"S/.",PHP:"",PKR:"",PLN:"z",PYG:"",QAR:"..",RON:"RON",RSD:".",RUB:".",RWF:"FR",SAR:"..",SDG:"SDG",SEK:"kr",SGD:"$",SOS:"Ssh",SYP:"..",THB:"",TND:"..",TOP:"T$",TRY:"TL",TTD:"$",TWD:"NT$",TZS:"TSh",UAH:"",UGX:"USh",UYU:"$",UZS:"UZS",VEF:"Bs.F.",VND:"",XAF:"FCFA",XOF:"CFA",YER:"..",ZAR:"R",ZMK:"ZK",ZWL:"ZWL$"},Ra=()=>{var e,t;return Number((t=(e=window.Shopify)==null?void 0:e.currency)==null?void 0:t.rate)===1},Sd=e=>typeof e=="string"&&e.includes("cdn.shopify.com"),je={soldOut:"already sold out",sellingPlanRequired:"Variant can only be purchased with a selling plan."},Ma=[a.addToCartDisableDefault,a.setAnonymousIdToCart,a.loginWithMultipassUrlRequest,a.cartItemQuantityChange,a.cartDataRequest,a.productRecommendationsRequest,a.requestProductsUpdate,a.blockAnonymousIdToCart],qe=[a.addToCart,a.spotlightCarouselQuickShopClick],Kt=e=>({headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});let ze=!1,jt=!1;const qt={},ft={};class it{constructor(){y(this,"getProduct",t=>h(this,null,function*(){if(qt[t])return qt[t];if(ft[t])return ft[t];const o=this.fetchRawProduct(t);ft[t]=o;const s=yield o;return qt[t]=s,delete ft[t],s}));y(this,"onRequestProductsUpdateMessage",o=>h(this,[o],function*({handles:t}){const n=[...new Set(t)].map(r=>this.getProduct(r)),i=(yield Promise.all(n)).filter(Boolean);for(const r of i)u.postMessage({eventName:a.productUpdateResponse,product:r})}));y(this,"shopifyAddToCart",r=>h(this,[r],function*({variantId:t,productHandle:o,sellingPlanId:s,quantity:n=Is,transmissionId:i}){const c={};jt||(c._isAddedFromTolstoy=!0);const l={id:t,quantity:n,properties:c};s&&(l.selling_plan=s);const g=Kt({items:[l]});try{const p=yield fetch(`${this.storeRootUrl}cart/add.js`,g);if(!p.ok){const I=yield p.json();return this.handleAddToCartError({error:I,variantId:t,productHandle:o,transmissionId:i})}this.triggerExternalCartUpdate(),u.postMessage({eventName:a.addToCartSuccess,variantId:t,transmissionId:i,shouldEndTransmission:!1}),this.getCart({transmissionId:i})}catch(p){console.log(p),this.handleAddToCartError({error:p,variantId:t,productHandle:o,transmissionId:i})}}));y(this,"shopifyUpdateItemQuantity",n=>h(this,[n],function*({variantId:t,quantity:o,transmissionId:s}){const i={updates:{[t]:o}},r=Kt(i);try{const c=yield fetch(`${this.storeRootUrl}cart/update.js`,r);if(!c.ok){const l=yield c.json();return this.handleUpdateItemQuantityError({error:l,variantId:t,transmissionId:s})}this.triggerExternalCartUpdate(),u.postMessage({eventName:a.cartItemQuantityChangeSuccess,variantId:t,transmissionId:s,shouldEndTransmission:!1}),this.getCart({transmissionId:s})}catch(c){this.handleUpdateItemQuantityError({error:c,variantId:t,transmissionId:s})}}));y(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.addToCart:return this.shopifyAddToCart(t.data);case a.spotlightCarouselQuickShopClick:return this.shopifyQuickShopClick(t.data);case a.addToCartDisableDefault:return this.disableAddToCart(t.data);case a.blockAnonymousIdToCart:return this.blockAnonymousIdToCart(t.data);case a.setAnonymousIdToCart:return this.setAnonymousIdToCart(t.data);case a.loginWithMultipassUrlRequest:return this.loginWithMultipassUrl(t.data);case a.cartItemQuantityChange:return this.shopifyUpdateItemQuantity(t.data);case a.cartDataRequest:return this.getCart(t.data);case a.productRecommendationsRequest:return this.getProductRecommendations(t.data);case a.requestProductsUpdate:return this.onRequestProductsUpdateMessage(t.data);default:return null}});y(this,"initInternalMessagingSubscriptions",()=>{if(u.subscribeMultipleEvents({eventNames:Ma,callback:this.internalMessagingHandler}),ze){bn("Add to cart disabled");return}u.subscribeMultipleEvents({eventNames:qe,callback:this.internalMessagingHandler})});var t,o,s,n;if(it.instance)return it.instance;it.instance=this,this.isShopifyStore=!!((t=window.Shopify)!=null&&t.shop&&((o=window.Shopify)!=null&&o.routes)),this.storeRootUrl=(n=(s=window.Shopify)==null?void 0:s.routes)==null?void 0:n.root}getIsProductSoldOutError(t){return t.includes(je.soldOut)}getIsSellingPlanError(t){return t.includes(je.sellingPlanRequired)}formatProduct(t){var n,i,r;if(!t)return null;const o=((i=(n=window.Shopify)==null?void 0:n.currency)==null?void 0:i.active)||((r=window.Shopify)==null?void 0:r.currency),s=window.tolstoyCurrencySymbol||Jo[o];return w(E({},t),{id:String(t.id),price:t.price/100,compare_at_price:t.compare_at_price?t.compare_at_price/100:t.compare_at_price,currencyCode:o,currencySymbol:s,variants:t.variants.map(c=>w(E({},c),{price:c.price/100,compare_at_price:c.compare_at_price?c.compare_at_price/100:c.compare_at_price}))})}fetchRawProduct(t){return h(this,null,function*(){const o=this.storeRootUrl+`products/${t}.js`;try{const n=yield(yield fetch(o)).json();return this.formatProduct(n)}catch(s){}})}handleSellingPlanError(t,o){return h(this,null,function*(){const s=yield this.getProduct(o);if(!s)return;const{id:n}=s.selling_plan_groups[0].selling_plans[0];return this.shopifyAddToCart({variantId:t,productHandle:o,sellingPlanId:n})})}handleAddToCartError({error:t,variantId:o,productHandle:s,transmissionId:n}){const{description:i}=t;if(this.getIsProductSoldOutError(i)){u.postMessage({eventName:a.addToCartSoldOut,variantId:o,transmissionId:n});return}if(this.getIsSellingPlanError(i))return this.handleSellingPlanError(o,s);u.postMessage({eventName:a.addToCartError,error:i,variantId:o,transmissionId:n})}handleUpdateItemQuantityError({error:t,variantId:o,transmissionId:s}){const{description:n}=t;u.postMessage({eventName:a.cartItemQuantityChangeError,error:n,variantId:o,transmissionId:s})}getCart(o){return h(this,arguments,function*({transmissionId:t}){try{const n=yield(yield fetch(`${this.storeRootUrl}cart.js`,{method:"GET"})).json();u.postMessage({eventName:a.cartDataResponse,cart:n,transmissionId:t})}catch(s){}})}triggerExternalCartUpdate(){var t,o,s,n,i,r,c,l,d,g,p;(i=(n=(s=(o=(t=window.VueMiniCart)==null?void 0:t.$store)==null?void 0:o._actions)==null?void 0:s.initCart)==null?void 0:n[0])==null||i.call(n),(l=(c=(r=window.slate)==null?void 0:r.cart)==null?void 0:c.reloadCart)==null||l.call(c),(d=window.tolstoyCartRefresh)==null||d.call(window),(g=window.monster_refresh)==null||g.call(window),(p=window.updateMiniCart)==null||p.call(window)}disableAddToCart(){ze=!0,u.unsubscribeMultipleEvents({eventNames:qe,callback:this.internalMessagingHandler})}postUrlLocaleUpdateIfNeeded(){var t,o,s,n;((o=(t=window.Shopify)==null?void 0:t.routes)==null?void 0:o.root)!=="/"&&u.postMessage({eventName:a.urlLocaleUpdate,urlLocale:(n=(s=window.Shopify)==null?void 0:s.routes)==null?void 0:n.root})}postIsNonBaseCurrencyIfNeeded(){Ra()||u.postMessage({eventName:a.isNonBaseCurrency})}shopifyQuickShopClick({product:t}){const{variants:o,handle:s,quantity:n=1}=t,i=o[0].id;return this.shopifyAddToCart({variantId:i,productHandle:s,quantity:n})}getProductRecommendations(s){return h(this,arguments,function*({productId:t,transmissionId:o}){const n=`${this.storeRootUrl}recommendations/products.json?product_id=${t}`;try{const i=yield fetch(n,{method:"GET"}),{products:r}=yield i.json();u.postMessage({eventName:a.productRecommendationsResponse,productId:t,products:r,transmissionId:o})}catch(i){}})}loginWithMultipassUrl(s){return h(this,arguments,function*({multipassUrl:t,transmissionId:o}){try{const n=yield fetch(t);u.postMessage({eventName:a.loginWithMultipassUrlResponse,statusCode:n.status,transmissionId:o})}catch(n){}})}setAnonymousIdToCart(o){return h(this,arguments,function*({anonymousId:t}){if(tn()==="true"||jt)return;const s={attributes:{[Ko.tolstoyAnonymousId]:t}},n=Kt(s);try{yield fetch(`${this.storeRootUrl}cart/update.js`,n),en(!0)}catch(i){console.error(i)}})}blockAnonymousIdToCart(o){return h(this,arguments,function*({appKey:t}){const s=Fs(t);Cn(s)||(yield this.setAnonymousIdToCart({anonymousId:null})),jt=!0})}forceClearAnonymousIdFromCart(){var o;if(((o=window.Shopify)==null?void 0:o.shop)!=="mlt-boutique.myshopify.com")return;const t=v();t&&this.blockAnonymousIdToCart({appKey:t})}init(){this.isShopifyStore&&(this.initInternalMessagingSubscriptions(),this.postUrlLocaleUpdateIfNeeded(),this.postIsNonBaseCurrencyIfNeeded(),this.forceClearAnonymousIdFromCart())}}const ts=new it;Object.freeze(ts);const La=e=>({id:e.id,price:e.price,compareAtPrice:e.price,currencyCode:e.currency,currencySymbol:Jo[e.currency],variants:[{price:e.price,compareAtPrice:e.price}]}),Na=(e="")=>e.replace("_","-"),Ua=[a.openCommerceSettingsUpdate,a.requestProductsUpdate],zt={},St={};class Da{constructor(){y(this,"fetchProduct",t=>h(this,null,function*(){const o=`${this.apiBaseUrl}/products/${t}`,s=new URL(o);s.searchParams.append("client_id",this.clientId),s.searchParams.append("locale",this.locale),s.searchParams.append("currency",this.currencyCode),s.searchParams.append("expand","prices");try{const i=yield(yield fetch(s)).json();return La(i)}catch(n){console.error("Error fetching product price",n)}}));y(this,"getProduct",t=>h(this,null,function*(){if(zt[t])return zt[t];if(St[t])return St[t];const o=this.fetchProduct(t);St[t]=o;const s=yield o;return zt[t]=s,delete St[t],s}));y(this,"onRequestProductsUpdateMessage",o=>h(this,[o],function*({productIds:t}){const n=[...new Set(t)].map(r=>this.getProduct(r)),i=(yield Promise.all(n)).filter(Boolean);for(const r of i)u.postMessage({eventName:a.productUpdateResponse,product:r})}));y(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.openCommerceSettingsUpdate:return this.onOpenCommerceSettingsUpdate(t.data);case a.requestProductsUpdate:return this.onRequestProductsUpdateMessage(t.data);default:return null}});var t,o,s,n;this.isOpenCommerceStore=!!window.CQuotient,this.siteId=(t=window.CQuotient)==null?void 0:t.siteId,this.locale=Na((o=window.CQuotient)==null?void 0:o.locale),this.apiBaseUrl="",this.clientId="",this.currencyCode=(n=(s=window.pageContext)==null?void 0:s.ecommerce)==null?void 0:n.currencyCode}postUrlLocaleUpdateIfNeeded(t){this.locale!==t&&u.postMessage({eventName:a.urlLocaleUpdate,urlLocale:this.locale})}postIsNonBaseCurrencyIfNeeded(t){this.currencyCode!==t&&u.postMessage({eventName:a.isNonBaseCurrency,currencyCode:this.currencyCode})}onOpenCommerceSettingsUpdate({openCommerceSettings:t}){const{apiVersion:o,clientId:s,baseLocale:n,baseCurrency:i}=t;this.apiBaseUrl=`https://${window.location.host}/s/${this.siteId}/dw/shop/${o}`,this.clientId=s,this.postUrlLocaleUpdateIfNeeded(n),this.postIsNonBaseCurrencyIfNeeded(i)}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Ua,callback:this.internalMessagingHandler})}init(){this.isOpenCommerceStore&&this.initInternalMessagingSubscriptions()}}const ka=new Da,Ba=[S.productUpdate],$a=["id","descriptionHtml","description_html","variants","price","compare_at_price","title"],Ha=["id","price","compare_at_price","title"],xa=e=>$a.includes(e),Wa=e=>Array.isArray(e)?e.flatMap((t,o)=>{const n=Object.keys(t).filter(i=>!Ha.includes(i));return n.length===0?[]:`variants[${o}]: { ${n.join(", ")} }`}):["variants (must be an array)"],Va=({product:e})=>{const o=Object.keys(e).filter(s=>!xa(s));if(e.variants&&o.push(...Wa(e.variants)),o.length>0){console.error(`Fields ${o.join(", ")} are not supported for product update.`);return}u.postMessage({product:e,eventName:a.productUpdateResponse})},Ya=({data:e})=>{switch(e.eventName){case S.productUpdate:return Va(e);default:return null}};class Fa{initExternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Ba,callback:Ya})}init(){this.initExternalMessagingSubscriptions()}}const es=new Fa;Object.freeze(es);const Ga=[S.addToCartSuccess,S.addToCartError];class rt{constructor(){y(this,"postMessageToWidgetV2",t=>{const{data:o}=t||{},{eventName:s,subscribedEventName:n}=o||{};if(!s&&!n)return;const i=new CustomEvent("TOLSTOY_WIDGET_V2_MESSAGE",{detail:w(E({},o),{eventName:n||s})});window.dispatchEvent(i)});y(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Ga,callback:this.postMessageToWidgetV2})});if(rt.instance)return rt.instance;rt.instance=this}init(){this.initExternalMessagingSubscriptions()}}const os=new rt;Object.freeze(os);const Ka=[a.addToCartError,a.addToCartSuccess,a.addToCartSoldOut,a.isRebuyAppInstalled,a.isAfterpayAppInstalled,a.openRebuyCart,a.returnProductsMetafields,a.rejectCookiePolicy,a.productCardClickSubscribed,a.isTapcart,a.urlLocaleUpdate,a.loginWithMultipassUrlResponse,a.cartDataResponse,a.cartItemQuantityChangeSuccess,a.cartItemQuantityChangeError,a.productRecommendationsResponse,a.productUpdateResponse,a.isNonBaseCurrency,a.eventListenersInitialized],Tt={},Zt={},It={},Xt=[];class at{constructor(){y(this,"eventHandler",({data:t={}})=>{const{modalId:o,eventName:s}=t;if(o)switch(s){case a.addToCart:case a.openRebuyCart:case a.openKendoModal:case a.getProductsMetafields:case a.productCardClick:case a.loginWithMultipassUrlRequest:case a.cartItemQuantityChange:case a.cartDataRequest:case a.productRecommendationsRequest:case a.requestProductsUpdate:case a.moveToUrl:case a.showFeedProductModal:case a.reportModalOpen:case a.reportModalClose:case Ze:return this.postInternalMessage({modalId:o,data:t});case a.modalMessagingReady:return this.postInternalMessage({modalId:o,data:t}),this.handleModalMessagingReady({modalId:o});case a.toggleFeedCloseButton:return this.postInternalMessage({modalId:o,data:t});default:return null}});y(this,"internalEventHandler",({data:t})=>{this.postMessageToModal(t)});y(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Ka,callback:this.internalEventHandler})});if(at.instance)return at.instance;at.instance=this}registerIframe({modalId:t,modalIframe:o}){Tt[t]=o}postInternalMessage({modalId:t,data:o}){delete o.modalId;const s=u.postMessage(o);It[s]=t}handleModalMessagingReady({modalId:t}){Zt[t]=!0;const o=Tt[t];for(const s of Xt){const{transmissionId:n}=s,i=It[n];(!i||i===t)&&this.postMessageToIframe({iframe:o,message:s})}}postMessageToIframe({iframe:t,message:o}){var s;(s=t.contentWindow)==null||s.postMessage(o,"*")}postMessageToAllIframes({message:t}){Xt.push(t);for(const[o,s]of Object.entries(Tt))Zt[o]&&this.postMessageToIframe({iframe:s,message:t})}postMessageToModal(t){const l=t,{transmissionId:o,shouldEndTransmission:s=!0}=l,n=Me(l,["transmissionId","shouldEndTransmission"]),i=It[o];if(!i)return this.postMessageToAllIframes({message:n});if(!Zt[i]){Xt.push(t);return}const c=Tt[i];this.postMessageToIframe({iframe:c,message:n}),s&&delete It[o]}init(){this.initInternalMessagingSubscriptions(),window.addEventListener("message",this.eventHandler)}}const ce=new at;Object.freeze(ce);const ja=50,qa="8b32dacc-8f1d-4cce-b641-9f60e88f9414",za=()=>{var t,o;const e=((t=document.currentScript)==null?void 0:t.src)||((o=import.meta)==null?void 0:o.url);if(e!=null&&e.includes("/we/widget.js")){$e({src:`https://${oe}/wes/widget.js`,container:document.head,attributes:{type:"module"}});return}$e({src:`https://${oe}/ws/widget.js`,container:document.head})},Za=()=>!!document.body,Xa=()=>{try{return window.self!==window.top}catch(e){return!0}},Qa=()=>Xa()&&window.location.host==="theordinary.com",ss=()=>h(void 0,null,function*(){var e,t,o,s,n,i;try{if(window.tolstoyWidget||Qa())return;if(jr()){console.debug("Bot user");return}if(!Za()){setTimeout(ss,ja);return}if(dt()&&(yield ni()),D("td")==="true"&&!((o=(t=(e=document.currentScript)==null?void 0:e.src)==null?void 0:t.includes)!=null&&o.call(t,"/ws/widget.js"))&&!((i=(n=(s=import.meta)==null?void 0:s.url)==null?void 0:n.includes)!=null&&i.call(n,"/wes/widget.js"))){za();return}xn(),sc(),nc(),ic(),rc(),ac(),cc(),Ro(),yield Ja(),yield Promise.all([tc(),ec(),oc()]),ii()}catch(r){console.log("error",r)}}),Ja=()=>h(void 0,null,function*(){return Wo.init()}),tc=e=>new xr(e).init(),ec=()=>new Yr().init(),oc=()=>new Br().init(),sc=()=>(u.init(),u),nc=()=>(ce.init(),ce),ic=()=>{_t.init();const{subscribe:e,unsubscribe:t}=_t;return window.tolstoyWidget=w(E({},window.tolstoyWidget),{subscribe:e,unsubscribe:t}),_t},rc=()=>{const{postMessage:e,closePlayer:t,identify:o,changeEmail:s}=ae;return window.tolstoyWidget=w(E({},window.tolstoyWidget),{postMessage:e,closePlayer:t,identify:o,changeEmail:s}),ae},ac=()=>{ts.init(),Yo.init(),jo.init(),Zo.init(),Xo.init(),Qo.init(),Fo.init(),Go.init(),qo.init(),ka.init(),es.init(),os.init(),v()===qa&&zo.init()},cc=()=>{u.subscribeMultipleEvents({eventNames:Fr,callback:Gr})};ss();export{ps as $,El as A,ud as B,Qt as C,Bc as D,Nc as E,Mi as F,Vt as G,pc as H,a as I,id as J,Bo as K,me as L,So as M,Ge as N,_n as O,hs as P,Bl as Q,u as R,Es as S,Dc as T,kc as U,$c as V,Cr as W,Uc as X,Y,jc as Z,C as _,cn as a,Vl as a$,te as a0,ms as a1,ko as a2,vr as a3,Cn as a4,od as a5,Ol as a6,vl as a7,Nr as a8,ol as a9,Ml as aA,Qe as aB,xo as aC,xe as aD,nl as aE,rl as aF,Ze as aG,Ht as aH,xt as aI,Kc as aJ,il as aK,sl as aL,Wl as aM,Dl as aN,tl as aO,el as aP,ml as aQ,no as aR,mo as aS,Pt as aT,br as aU,_o as aV,ce as aW,wl as aX,wo as aY,Js as aZ,td as a_,md as aa,ee as ab,Ir as ac,gd as ad,Rl as ae,nd as af,Fc as ag,xc as ah,ws as ai,Vc as aj,Wc as ak,jl as al,ql as am,zl as an,f as ao,m as ap,ki as aq,Yc as ar,Ct as as,Cl as at,dd as au,Ll as av,zc as aw,to as ax,Nl as ay,Je as az,Dt as b,ad as b$,bn as b0,kl as b1,yo as b2,Vr as b3,wd as b4,mn as b5,dt as b6,io as b7,Il as b8,fd as b9,Gc as bA,fn as bB,bl as bC,Ec as bD,uc as bE,hc as bF,dc as bG,gc as bH,yc as bI,Sl as bJ,Nt as bK,cl as bL,Ul as bM,al as bN,wc as bO,mc as bP,Sc as bQ,fc as bR,Tc as bS,vc as bT,pl as bU,$l as bV,di as bW,ui as bX,Al as bY,pi as bZ,Hl as b_,_l as ba,_s as bb,Jl as bc,Wt as bd,Ql as be,Jc as bf,Zs as bg,Qc as bh,Hs as bi,us as bj,Ac as bk,Mc as bl,ds as bm,cd as bn,bc as bo,Ic as bp,Q as bq,Mr as br,fs as bs,Cc as bt,un as bu,ul as bv,_c as bw,S as bx,Sn as by,Tl as bz,Ed as c,Pl as c0,Xl as c1,Zl as c2,Rc as c3,Gl as c4,Sd as c5,xl as c6,Kl as c7,Pc as c8,ii as c9,gl as ca,hl as cb,yl as cc,fl as cd,De as ce,At as cf,R as cg,qc as ch,sd as ci,ed as cj,yd as d,Oc as e,Pr as f,ld as g,v as h,Fl as i,Mo as j,rd as k,vo as l,Yl as m,pd as n,_r as o,Z as p,Do as q,ys as r,Lc as s,hd as t,Lr as u,Hc as v,Jt as w,ll as x,dl as y,D as z};
